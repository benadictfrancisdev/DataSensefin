import{g as F,r,u as A,h as he,i as Pe,s as v,j as e,S as te,Z as Ae,k as U,f as ae,B as L,l as re,m as ze,n as E,F as De,L as O,o as _e,U as Fe,I as Re,p as Ve,e as Ue,C as xe,q as ne,t as $e}from"./index-CG6I4ibZ.js";import{P as ie,a as oe,b as ce}from"./popover-DNDT6pWB.js";import{T as He}from"./trash-2-GddBIG4P.js";import{P as Oe}from"./palette-BFgSVLTd.js";import{M as le,a as Be}from"./mic-CHBV1apw.js";import{T as ge}from"./trending-up-Dqe0U41A.js";import{C as We}from"./chart-line-DVZvcpV3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=F("Frown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=F("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=F("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=F("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=F("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Ze=(t={})=>{const{onTranscript:c,onFinalTranscript:i,continuous:g=!1,language:m="en-US"}=t,[n,p]=r.useState(!1),[z,M]=r.useState(""),[D,k]=r.useState(!1),y=r.useRef(null);r.useEffect(()=>{const T=window.SpeechRecognition||window.webkitSpeechRecognition;if(k(!!T),T){const b=new T;b.continuous=g,b.interimResults=!0,b.lang=m,b.onresult=w=>{let q="",C="";for(let N=w.resultIndex;N<w.results.length;N++){const V=w.results[N][0].transcript;w.results[N].isFinal?C+=V:q+=V}const R=C||q;M(R),c&&c(R),C&&i&&i(C)},b.onerror=w=>{console.error("Speech recognition error:",w.error),p(!1),w.error==="not-allowed"?A.error("Microphone access denied. Please allow microphone access."):w.error!=="aborted"&&A.error(`Voice input error: ${w.error}`)},b.onend=()=>{g&&n?b.start():p(!1)},y.current=b}return()=>{y.current&&y.current.abort()}},[g,m,c,i,n]);const l=r.useCallback(()=>{if(y.current&&!n)try{y.current.start(),p(!0),M("")}catch(T){console.error("Failed to start speech recognition:",T)}},[n]),d=r.useCallback(()=>{y.current&&n&&(y.current.stop(),p(!1))},[n]),u=r.useCallback(()=>{n?d():l()},[n,l,d]),I=r.useCallback(()=>{M("")},[]);return{isListening:n,isSupported:D,transcript:z,startListening:l,stopListening:d,toggleListening:u,resetTranscript:I}},Je=(t,c=new SpeechSynthesisUtterance)=>{if(!("speechSynthesis"in window)){console.warn("Text-to-speech not supported");return}window.speechSynthesis.cancel();const i=new SpeechSynthesisUtterance(t);i.rate=c.rate||1,i.pitch=c.pitch||1,i.volume=c.volume||1;const g=window.speechSynthesis.getVoices(),m=g.find(n=>n.lang.startsWith("en")&&(n.name.includes("Natural")||n.name.includes("Google")))||g.find(n=>n.lang.startsWith("en"));m&&(i.voice=m),window.speechSynthesis.speak(i)},es=()=>{"speechSynthesis"in window&&window.speechSynthesis.cancel()},ue={expertiseLevel:"intermediate",preferredChartTypes:[],commonQueries:[],interactionStats:{totalMessages:0,questionsAsked:0,visualizationsRequested:0,averageMessageLength:0},uiPreferences:{voiceEnabled:!0,autoSuggestions:!0,compactMode:!1,theme:"system"},lastUpdated:new Date().toISOString()},B="data-agent-preferences",ss=()=>{const{user:t}=he(),[c,i]=r.useState(ue),[g,m]=r.useState(!0);r.useEffect(()=>{if(t){const l=`${B}-${t.id}`,d=localStorage.getItem(l);if(d)try{i(JSON.parse(d))}catch(u){console.error("Failed to parse stored preferences:",u)}}m(!1)},[t]);const n=r.useCallback(l=>{if(!t)return;const d={...c,...l,lastUpdated:new Date().toISOString()};i(d);const u=`${B}-${t.id}`;localStorage.setItem(u,JSON.stringify(d))},[t,c]),p=r.useCallback((l,d)=>{const u={...c.interactionStats};u.totalMessages++,l==="question"?u.questionsAsked++:l==="visualization"&&u.visualizationsRequested++,d&&(u.averageMessageLength=Math.round((u.averageMessageLength*(u.totalMessages-1)+d)/u.totalMessages));let I=c.expertiseLevel;u.totalMessages>20&&(u.averageMessageLength>100&&u.visualizationsRequested>5?I="expert":(u.totalMessages>50||u.questionsAsked>20)&&(I="intermediate")),n({interactionStats:u,expertiseLevel:I})},[c,n]),z=r.useCallback(l=>{const d=[...c.commonQueries];d.includes(l)||(d.unshift(l),d.length>20&&d.pop(),n({commonQueries:d}))},[c,n]),M=r.useCallback(l=>{const d=[...c.preferredChartTypes],u=d.indexOf(l);u>-1&&d.splice(u,1),d.unshift(l),d.length>10&&d.pop(),n({preferredChartTypes:d})},[c,n]),D=r.useCallback(l=>{n({uiPreferences:{...c.uiPreferences,...l}})},[c,n]),k=r.useCallback(l=>{n({expertiseLevel:l})},[n]),y=r.useCallback(()=>{if(!t)return;i(ue);const l=`${B}-${t.id}`;localStorage.removeItem(l)},[t]);return{preferences:c,isLoading:g,trackInteraction:p,trackQuery:z,trackChartPreference:M,updateUIPreferences:D,setExpertiseLevel:k,resetPreferences:y,savePreferences:n}},me=[{name:"Default",user:"bg-primary",assistant:"bg-muted/50"},{name:"Ocean",user:"bg-blue-600",assistant:"bg-blue-900/30"},{name:"Forest",user:"bg-green-600",assistant:"bg-green-900/30"},{name:"Sunset",user:"bg-orange-600",assistant:"bg-orange-900/30"},{name:"Purple",user:"bg-purple-600",assistant:"bg-purple-900/30"},{name:"Rose",user:"bg-pink-600",assistant:"bg-pink-900/30"}],ts=[{value:"beginner",label:"Beginner",description:"Simple explanations with examples"},{value:"intermediate",label:"Intermediate",description:"Standard technical detail"},{value:"expert",label:"Expert",description:"Advanced insights, no hand-holding"}],as=t=>{switch(t){case"positive":return e.jsx(Ke,{className:"w-3 h-3 text-green-500"});case"negative":return e.jsx(de,{className:"w-3 h-3 text-red-500"});case"frustrated":return e.jsx(de,{className:"w-3 h-3 text-orange-500"});case"curious":return e.jsx(ne,{className:"w-3 h-3 text-blue-500"});case"confused":return e.jsx(ne,{className:"w-3 h-3 text-yellow-500"});default:return e.jsx(Qe,{className:"w-3 h-3 text-muted-foreground"})}},rs=t=>{switch(t){case"bar":return e.jsx(xe,{className:"w-4 h-4"});case"pie":return e.jsx($e,{className:"w-4 h-4"});case"line":return e.jsx(We,{className:"w-4 h-4"});default:return e.jsx(ge,{className:"w-4 h-4"})}},ms=({dataset:t})=>{const{user:c}=he(),[i,g]=r.useState([]),[m,n]=r.useState(""),[p,z]=r.useState(!1),[M,D]=r.useState(!0),[k,y]=r.useState(me[0]),[l,d]=r.useState(!0),[u,I]=r.useState([]),[T,b]=r.useState(!1),[w,q]=r.useState(!1),[C,R]=r.useState(null),[N,V]=r.useState(null),W=r.useRef(null),Q=r.useRef(null),{preferences:S,trackInteraction:$,trackQuery:pe,setExpertiseLevel:fe,updateUIPreferences:ye}=ss(),{exportChatToPdf:be,generateShareableLink:we}=Pe(),{isListening:P,isSupported:G,startListening:je,stopListening:ve,transcript:H}=Ze({onFinalTranscript:s=>{n(a=>a+" "+s)}}),Ne=()=>{if(i.length===0){A.error("No messages to export");return}be(i,t.name,`Chat with ${t.name}`)},Se=()=>{if(i.length===0){A.error("No messages to share");return}we(i,t.name)};r.useEffect(()=>{(async()=>{if(!c||!t.name){D(!1);return}try{const{data:a}=await v.from("conversation_sessions").select("id").eq("user_id",c.id).eq("dataset_name",t.name).eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a){V(a.id);const{data:o}=await v.from("chat_messages").select("*").eq("session_id",a.id).order("created_at",{ascending:!0});if(o&&o.length>0){const h=o.map(x=>({role:x.role,content:x.content,sentiment:x.sentiment,suggestions:x.suggestions||void 0,chartSuggestion:x.chart_suggestion,timestamp:new Date(x.created_at)}));g(h)}}else{const{data:o}=await v.from("conversation_sessions").insert([{user_id:c.id,dataset_name:t.name,title:`Chat with ${t.name}`}]).select().single();o&&V(o.id)}}catch(a){console.error("Failed to load chat history:",a)}finally{D(!1)}})()},[c,t.name]);const K=async s=>{if(!(!c||!N))try{await v.from("chat_messages").insert([{session_id:N,user_id:c.id,role:s.role,content:s.content,sentiment:s.sentiment,suggestions:s.suggestions||null,chart_suggestion:s.chartSuggestion}])}catch(a){console.error("Failed to save message:",a)}},ke=async()=>{if(N)try{await v.from("chat_messages").delete().eq("session_id",N),g([]),A.success("Chat history cleared")}catch(s){console.error("Failed to clear history:",s),A.error("Failed to clear history")}},Ce=()=>{var s;(s=W.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{Ce()},[i]),r.useEffect(()=>{H&&P&&n(s=>{const a=s.split(" ").filter(h=>h),o=H.split(" ").filter(h=>h);return[...a,...o.slice(-1)].join(" ")})},[H,P]);const Y=r.useCallback(async s=>{if(!(s.length<3||p)){b(!0);try{const a=`Dataset: ${t.name}, Columns: ${t.columns.join(", ")}, Rows: ${t.rawData.length}`,{data:o,error:h}=await v.functions.invoke("voice-synthesis",{body:{action:"generate-suggestions",text:s,dataContext:a,conversationHistory:i.slice(-5),userContext:S}});if(h)throw h;const x=[...(o.autoComplete||[]).map(f=>({label:f,query:f,icon:e.jsx(te,{className:"w-3 h-3"})})),...(o.quickActions||[]).map(f=>({label:f.label,query:f.query,icon:e.jsx(Ae,{className:"w-3 h-3"})}))];I(x.slice(0,5)),R(o.didYouMean),q(x.length>0)}catch(a){console.error("Failed to generate suggestions:",a)}finally{b(!1)}}},[t,i,S,p]);r.useEffect(()=>{const s=setTimeout(()=>{m.length>=3&&S.uiPreferences.autoSuggestions?Y(m):q(!1)},500);return()=>clearTimeout(s)},[m,Y,S.uiPreferences.autoSuggestions]);const Le=async s=>{try{const{data:a,error:o}=await v.functions.invoke("voice-synthesis",{body:{action:"analyze-sentiment",message:s,conversationHistory:i.slice(-3)}});if(o)throw o;return a}catch(a){return console.error("Sentiment analysis failed:",a),null}},Ee=async(s,a)=>{if(!a||S.expertiseLevel==="expert")return s;try{const{data:o,error:h}=await v.functions.invoke("voice-synthesis",{body:{action:"adapt-response",originalResponse:s,sentiment:a,userLevel:S.expertiseLevel}});if(h)throw h;return o.adaptedResponse||s}catch(o){return console.error("Response adaptation failed:",o),s}},Me=async()=>{try{const{data:s,error:a}=await v.functions.invoke("voice-synthesis",{body:{action:"recommend-chart",datasetName:t.name,columns:t.columns,columnTypes:t.columns.reduce((o,h)=>{const f=t.rawData.slice(0,10).map(_=>_[h]).filter(_=>!isNaN(Number(_))).length;return o[h]=f>7?"numeric":"categorical",o},{}),sampleData:t.rawData.slice(0,5),rowCount:t.rawData.length,analysisGoal:i.length>0?i[i.length-1].content:"General visualization"}});if(a)throw a;return s}catch(s){return console.error("Chart recommendation failed:",s),null}},X=async()=>{var o,h;if(!m.trim()||p)return;$("message",m.length),m.includes("?")&&$("question"),pe(m);const s=await Le(m),a={role:"user",content:m,sentiment:s,timestamp:new Date};g(x=>[...x,a]),K(a),n(""),q(!1),z(!0);try{const x=t.cleanedData||t.rawData,{data:f,error:_}=await v.functions.invoke("data-agent",{body:{action:"chat",data:x.slice(0,200),datasetName:t.name,question:m,conversationHistory:i.slice(-10).map(j=>({role:j.role,content:j.content}))}});if(_)throw _;const J=await Ee(f.response,s);let ee=null;if(m.toLowerCase().includes("visualiz")||m.toLowerCase().includes("chart")||m.toLowerCase().includes("graph")||m.toLowerCase().includes("show me")){$("visualization");const j=await Me();j!=null&&j.recommendedChart&&(ee={type:j.recommendedChart.type,xAxis:(o=j.configuration)==null?void 0:o.xAxis,yAxis:(h=j.configuration)==null?void 0:h.yAxis})}const se={role:"assistant",content:J,suggestions:f.suggestions||["Tell me more about this","What are the trends?","Show me a visualization"],chartSuggestion:ee,timestamp:new Date};g(j=>[...j,se]),K(se),l&&S.uiPreferences.voiceEnabled&&Je(J)}catch(x){A.error(x instanceof Error?x.message:"Failed to get response"),g(f=>f.slice(0,-1))}finally{z(!1)}},Z=s=>{var a;n(s.query),q(!1),(a=Q.current)==null||a.focus()},Ie=s=>{n(s),setTimeout(()=>X(),100)},Te=()=>{const s=!l;d(s),ye({voiceEnabled:s}),s||es()},qe=[{label:"What are the key trends?",query:"What are the key trends in this data?",icon:e.jsx(ge,{className:"w-3 h-3"})},{label:"Find anomalies",query:"Are there any anomalies or outliers in this data?",icon:e.jsx(Ue,{className:"w-3 h-3"})},{label:"Summarize findings",query:"Summarize the main findings from this dataset",icon:e.jsx(re,{className:"w-3 h-3"})},{label:"Best visualization",query:"What's the best way to visualize this data?",icon:e.jsx(xe,{className:"w-3 h-3"})}];return e.jsxs("div",{className:"flex flex-col h-[650px] bg-card/50 rounded-xl border border-border/50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border/50 bg-card/80",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-primary to-cyan-400 flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:"AI Data Assistant"}),e.jsxs(ae,{variant:"secondary",className:"text-xs gap-1",children:[e.jsx(te,{className:"w-3 h-3"}),S.expertiseLevel]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Emotionally intelligent • Voice enabled"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ie,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(L,{variant:"ghost",size:"sm",className:"gap-1 h-8",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx(ze,{className:"w-3 h-3"})]})}),e.jsxs(ce,{className:"w-56 p-2",children:[e.jsx("p",{className:"text-xs font-medium mb-2 px-2",children:"Expertise Level"}),ts.map(s=>e.jsxs("button",{onClick:()=>fe(s.value),className:E("w-full flex flex-col items-start p-2 rounded-lg hover:bg-muted/50 transition-colors text-left",S.expertiseLevel===s.value&&"bg-muted"),children:[e.jsx("span",{className:"text-sm font-medium",children:s.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.description})]},s.value))]})]}),e.jsx(L,{variant:"ghost",size:"sm",onClick:Te,className:E("h-8 w-8 p-0",l&&"text-primary"),children:l?e.jsx(Ye,{className:"w-4 h-4"}):e.jsx(Xe,{className:"w-4 h-4"})}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:Ne,className:"h-8 w-8 p-0 text-muted-foreground hover:text-primary",title:"Export chat to PDF",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:Se,className:"h-8 w-8 p-0 text-muted-foreground hover:text-primary",title:"Copy shareable link",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:ke,className:"h-8 w-8 p-0 text-muted-foreground hover:text-destructive",title:"Clear chat history",children:e.jsx(He,{className:"w-4 h-4"})})]}),e.jsxs(ie,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"w-4 h-4"})})}),e.jsxs(ce,{className:"w-40 p-2",children:[e.jsx("p",{className:"text-xs font-medium mb-2 px-2",children:"Theme"}),me.map(s=>e.jsxs("button",{onClick:()=>y(s),className:E("w-full flex items-center gap-2 p-2 rounded-lg hover:bg-muted/50 transition-colors",k.name===s.name&&"bg-muted"),children:[e.jsx("div",{className:E("w-4 h-4 rounded-full",s.user)}),e.jsx("span",{className:"text-sm",children:s.name})]},s.name))]})]})]})]}),M&&e.jsxs("div",{className:"flex items-center justify-center gap-2 p-4 text-muted-foreground",children:[e.jsx(O,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading chat history..."})]}),e.jsx(_e,{className:"flex-1 p-4",children:i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full space-y-6 py-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-3xl bg-gradient-to-br from-primary via-cyan-400 to-purple-500 flex items-center justify-center shadow-glow animate-pulse",children:e.jsx(U,{className:"w-10 h-10 text-primary-foreground"})}),e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-2 gradient-text",children:"Smart Data Conversations"}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"I adapt to your expertise level and understand your emotions. Use voice or text to explore your data naturally."})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center max-w-lg",children:qe.map((s,a)=>e.jsxs("button",{onClick:()=>Z(s),className:"flex items-center gap-2 px-4 py-2 text-sm bg-muted/50 hover:bg-muted rounded-full border border-border/50 hover:border-primary/50 transition-all hover:shadow-button",children:[s.icon,s.label]},a))}),G&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground bg-muted/30 px-4 py-2 rounded-full",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsx("span",{children:"Click the mic button or press and hold to speak"})]})]}):e.jsxs("div",{className:"space-y-4",children:[i.map((s,a)=>e.jsxs("div",{className:E("flex gap-3 animate-fade-in",s.role==="user"?"justify-end":"justify-start"),children:[s.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 rounded-xl bg-gradient-to-br from-primary/20 to-cyan-400/20 flex items-center justify-center flex-shrink-0",children:e.jsx(U,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"max-w-[80%] space-y-2",children:[e.jsx("div",{className:E("p-3 rounded-2xl",s.role==="user"?`${k.user} text-white`:`${k.assistant} text-foreground border border-border/30`),children:e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:s.content})}),s.sentiment&&s.role==="user"&&e.jsxs("div",{className:"flex items-center gap-1 justify-end text-xs text-muted-foreground",children:[as(s.sentiment.sentiment),e.jsx("span",{className:"capitalize",children:s.sentiment.sentiment})]}),s.chartSuggestion&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-primary/10 border border-primary/20 text-xs",children:[rs(s.chartSuggestion.type),e.jsxs("span",{children:["Recommended: ",e.jsx("strong",{className:"capitalize",children:s.chartSuggestion.type})," chart"]}),s.chartSuggestion.xAxis&&e.jsxs(ae,{variant:"secondary",className:"text-xs",children:[s.chartSuggestion.xAxis," → ",s.chartSuggestion.yAxis]})]}),s.suggestions&&s.role==="assistant"&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pt-1",children:s.suggestions.slice(0,3).map((o,h)=>e.jsx("button",{onClick:()=>Ie(o),className:"text-xs px-2.5 py-1 rounded-full bg-muted/50 hover:bg-muted border border-border/50 hover:border-primary/30 transition-colors",children:o},h))})]}),s.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-xl bg-secondary flex items-center justify-center flex-shrink-0",children:e.jsx(Fe,{className:"w-4 h-4 text-secondary-foreground"})})]},a)),p&&e.jsxs("div",{className:"flex gap-3 justify-start animate-fade-in",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-gradient-to-br from-primary/20 to-cyan-400/20 flex items-center justify-center",children:e.jsx(U,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:E("p-3 rounded-2xl",k.assistant),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 animate-spin text-primary"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Thinking..."})]})})]}),e.jsx("div",{ref:W})]})}),e.jsxs("div",{className:"p-4 border-t border-border/50 bg-card/80 space-y-2",children:[C&&e.jsxs("button",{onClick:()=>{n(C),R(null)},className:"w-full text-left text-xs text-muted-foreground hover:text-foreground p-2 rounded-lg bg-muted/30 transition-colors",children:["Did you mean: ",e.jsx("span",{className:"text-primary font-medium",children:C}),"?"]}),w&&u.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 p-2 rounded-lg bg-muted/30 border border-border/50",children:[u.map((s,a)=>e.jsxs("button",{onClick:()=>Z(s),className:"flex items-center gap-1.5 text-xs px-2.5 py-1.5 rounded-full bg-background hover:bg-muted border border-border/50 hover:border-primary/30 transition-colors",children:[s.icon,s.label]},a)),T&&e.jsx(O,{className:"w-3 h-3 animate-spin text-muted-foreground"})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),X()},className:"flex gap-2",children:[G&&e.jsx(L,{type:"button",variant:P?"default":"outline",size:"icon",onClick:P?ve:je,className:E("shrink-0 transition-all",P&&"bg-red-500 hover:bg-red-600 animate-pulse"),children:P?e.jsx(Be,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"})}),e.jsx(Re,{ref:Q,value:m,onChange:s=>n(s.target.value),placeholder:P?"Listening...":"Ask about your data...",disabled:p,className:"flex-1 bg-background/50 border-border/50 focus:border-primary rounded-xl"}),e.jsx(L,{type:"submit",disabled:!m.trim()||p,className:"bg-gradient-to-r from-primary to-cyan-400 hover:opacity-90 rounded-xl",children:e.jsx(Ve,{className:"w-4 h-4"})})]})]})]})};export{ms as default};
