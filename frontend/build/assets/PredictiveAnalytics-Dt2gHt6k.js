import{r as j,i as ce,j as e,a as w,b as ie,A as E,c as oe,f as v,S as de,x as me,B as L,F as ue,L as V,Z as xe,d as y,T as q,v as X,G as he,H as pe,J as U,K as z,o as ge,u as je}from"./index-CG6I4ibZ.js";import{P as fe}from"./progress-DcGcylKX.js";import{T as H}from"./trending-up-Dqe0U41A.js";import{T as I}from"./target-BeagzYB1.js";import{C as Z}from"./clock-JgIc6NIT.js";import{M as Ne}from"./minus-CKncxuHD.js";import{A as ve,a as we}from"./arrow-up-right-DsX3IAhq.js";const $e=({data:T,columns:J,columnTypes:K,datasetName:Y})=>{const[P,G]=j.useState(!1),[b,O]=j.useState([]),[M,Q]=j.useState([]),[C,W]=j.useState([]),[S,_]=j.useState(!1),{exportToPdf:ee}=ce(),F=J.filter(s=>K[s]==="numeric"),se=()=>{ee({title:"Predictive Analytics Report",subtitle:`AI-Powered Analysis for ${Y}`,datasetName:Y,statistics:{"Anomalies Detected":b.length,"Forecasts Generated":M.length,"Patterns Found":C.length,"Numeric Columns":F.length},insights:[...b.slice(0,5).map(s=>({title:`Anomaly in ${s.column}`,description:s.description,importance:s.severity})),...C.map(s=>({title:s.title,description:s.description,importance:s.confidence>80?"high":"medium"}))],sections:[{title:"Forecasts Summary",type:"table",content:"",tableData:{headers:["Column","Current","Predicted","Change","Confidence"],rows:M.map(s=>[s.column,s.currentValue.toFixed(2),s.predictedValue.toFixed(2),`${s.trend==="up"?"+":s.trend==="down"?"-":""}${s.changePercent.toFixed(1)}%`,`${s.confidence}%`])}},{title:"Detected Patterns",type:"list",content:C.map(s=>`${s.title}: ${s.description}`)}],recommendations:["Investigate high-severity anomalies for data quality issues","Monitor forecasted trends for business planning","Use correlation patterns to identify key drivers"]})},u=j.useMemo(()=>F.map(s=>{const t=T.map(i=>Number(i[s])).filter(i=>!isNaN(i));if(t.length===0)return null;const a=t.reduce((i,g)=>i+g,0)/t.length,o=[...t].sort((i,g)=>i-g),c=o[Math.floor(t.length/2)],r=Math.max(...t),m=Math.min(...t),f=Math.sqrt(t.reduce((i,g)=>i+Math.pow(g-a,2),0)/t.length),d=o[Math.floor(t.length*.25)],p=o[Math.floor(t.length*.75)],x=p-d,l=d-1.5*x,D=p+1.5*x,$=Math.floor(t.length/2),N=t.slice(0,$),h=t.slice($),A=N.reduce((i,g)=>i+g,0)/N.length,R=h.reduce((i,g)=>i+g,0)/h.length,B=A>0?(R-A)/A*100:0;return{column:s,values:t,avg:a,median:c,max:r,min:m,stdDev:f,lowerBound:l,upperBound:D,trend:B>5?"up":B<-5?"down":"stable",trendChange:Math.abs(B)}}).filter(Boolean),[T,F]),te=j.useCallback(()=>{const s=[];return u.forEach(t=>{t&&t.values.forEach((n,a)=>{if(n<t.lowerBound||n>t.upperBound){const o=Math.abs(n-t.avg)/t.stdDev;let c="low",r="outlier";if(o>3?c="high":o>2&&(c="medium"),a>0&&a<t.values.length-1){const m=t.values[a-1];t.values[a+1],Math.abs(n-m)/Math.abs(m||1)>.5&&(r=n>m?"spike":"drop")}s.push({column:t.column,index:a,value:n,expectedRange:{min:t.lowerBound,max:t.upperBound},severity:c,type:r,description:`${r==="spike"?"Unusual spike":r==="drop"?"Sharp drop":"Statistical outlier"} detected at row ${a+1}`})}})}),s.slice(0,20)},[u]),ae=j.useCallback(()=>u.map(s=>{if(!s)return null;const t=s.values.length,n=(t-1)/2,a=s.avg;let o=0,c=0;s.values.forEach((N,h)=>{o+=(h-n)*(N-a),c+=(h-n)*(h-n)});const r=c!==0?o/c:0,m=a-r*n,f=m+r*t,d=s.values[s.values.length-1],p=d!==0?(f-d)/Math.abs(d)*100:0,x=s.values.reduce((N,h,A)=>{const R=m+r*A;return N+Math.pow(h-R,2)},0),l=s.values.reduce((N,h)=>N+Math.pow(h-a,2),0),D=l!==0?1-x/l:0,$=Math.max(0,Math.min(100,D*100+20));return{column:s.column,currentValue:d,predictedValue:f,confidence:Math.round($),trend:p>2?"up":p<-2?"down":"stable",changePercent:Math.abs(p),period:"Next period"}}).filter(Boolean),[u]),ne=j.useCallback(()=>{const s=[];if(u.forEach(t=>{t&&t.trend!=="stable"&&s.push({type:"trend",title:`${t.trend==="up"?"Upward":"Downward"} Trend in ${t.column}`,description:`${t.column} shows a ${t.trendChange.toFixed(1)}% ${t.trend==="up"?"increase":"decrease"} over the dataset period.`,confidence:85+Math.random()*10,affectedColumns:[t.column]})}),u.length>=2)for(let t=0;t<Math.min(u.length-1,3);t++){const n=u[t],a=u[t+1];if(n&&a&&n.values.length===a.values.length){let o=0,c=0,r=0,m=0,f=0;const d=n.values.length;for(let l=0;l<d;l++)c+=n.values[l],r+=a.values[l],o+=n.values[l]*a.values[l],m+=n.values[l]*n.values[l],f+=a.values[l]*a.values[l];const p=Math.sqrt((d*m-c*c)*(d*f-r*r)),x=p!==0?(d*o-c*r)/p:0;Math.abs(x)>.5&&s.push({type:"correlation",title:`${x>0?"Positive":"Negative"} Correlation Detected`,description:`${n.column} and ${a.column} show a ${Math.abs(x*100).toFixed(0)}% ${x>0?"positive":"negative"} correlation.`,confidence:75+Math.abs(x)*20,affectedColumns:[n.column,a.column]})}}return s.slice(0,8)},[u]),re=async()=>{G(!0),await new Promise(a=>setTimeout(a,500));const s=te();O(s),await new Promise(a=>setTimeout(a,500));const t=ae();Q(t),await new Promise(a=>setTimeout(a,500));const n=ne();W(n),_(!0),G(!1),je.success("Predictive analysis complete!")},k=s=>{switch(s){case"high":return"bg-red-500/10 text-red-500 border-red-500/30";case"medium":return"bg-yellow-500/10 text-yellow-500 border-yellow-500/30";case"low":return"bg-blue-500/10 text-blue-500 border-blue-500/30"}},le=s=>{switch(s){case"up":return e.jsx(we,{className:"h-4 w-4 text-green-500"});case"down":return e.jsx(ve,{className:"h-4 w-4 text-red-500"});default:return e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{className:"bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-primary/30",children:e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-primary to-primary/80 shadow-lg",children:e.jsx(E,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsxs(oe,{className:"text-xl flex items-center gap-2",children:["Predictive Analytics",e.jsxs(v,{variant:"secondary",className:"text-xs bg-purple-500/10 text-purple-500",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"No Code"]})]}),e.jsx(me,{className:"mt-1",children:"Anomaly detection & time series forecasting without modeling"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[S&&e.jsxs(L,{variant:"outline",onClick:se,className:"gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Export PDF"]}),e.jsx(L,{onClick:re,disabled:P,className:"bg-gradient-to-r from-primary to-purple-500",children:P?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Run Analysis"]})})]})]})})}),!S&&!P&&e.jsx(w,{className:"border-dashed border-2 border-muted-foreground/20",children:e.jsx(y,{className:"py-16 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted inline-block",children:e.jsx(E,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Start Predictive Analysis"}),e.jsx("p",{className:"text-muted-foreground",children:'Click "Run Analysis" to detect anomalies, generate forecasts, and discover patterns in your data automatically.'}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mt-4",children:[e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Anomaly Detection"]}),e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Forecasting"]}),e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Pattern Recognition"]})]})]})})}),P&&e.jsx(w,{children:e.jsx(y,{className:"py-12",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6 text-center",children:[e.jsx(V,{className:"h-12 w-12 animate-spin mx-auto text-primary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Running Predictive Analysis..."}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Analyzing ",T.length," records across ",F.length," numeric columns"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Detecting statistical anomalies"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-4 w-4 animate-spin text-primary"}),e.jsx("span",{className:"text-sm",children:"Generating forecasts"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Pattern recognition pending"})]})]})]})})}),S&&e.jsxs(he,{defaultValue:"anomalies",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-3 bg-muted/50",children:[e.jsxs(U,{value:"anomalies",className:"data-[state=active]:bg-red-500/10 data-[state=active]:text-red-500",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Anomalies (",b.length,")"]}),e.jsxs(U,{value:"forecasts",className:"data-[state=active]:bg-green-500/10 data-[state=active]:text-green-500",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Forecasts (",M.length,")"]}),e.jsxs(U,{value:"patterns",className:"data-[state=active]:bg-purple-500/10 data-[state=active]:text-purple-500",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Patterns (",C.length,")"]})]}),e.jsx(z,{value:"anomalies",className:"mt-4",children:b.length===0?e.jsx(w,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-green-500 mb-4"}),e.jsx("h3",{className:"font-semibold text-lg",children:"No Anomalies Detected"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Your data appears clean with no statistical outliers."})]})}):e.jsx(ge,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-3",children:b.map((s,t)=>e.jsx(w,{className:`border ${k(s.severity)}`,children:e.jsx(y,{className:"py-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${k(s.severity)}`,children:e.jsx(q,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.description}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Column: ",s.column," • Value: ",s.value.toFixed(2)," • Expected: ",s.expectedRange.min.toFixed(2)," - ",s.expectedRange.max.toFixed(2)]})]})]}),e.jsx(v,{className:k(s.severity),children:s.severity})]})})},t))})})}),e.jsx(z,{value:"forecasts",className:"mt-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map((s,t)=>e.jsx(w,{className:"hover:shadow-md transition-shadow",children:e.jsxs(y,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.column}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.period})]}),e.jsxs(v,{variant:"outline",className:s.trend==="up"?"text-green-500 border-green-500/30":s.trend==="down"?"text-red-500 border-red-500/30":"",children:[le(s.trend),s.changePercent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current"}),e.jsx("p",{className:"text-lg font-bold",children:s.currentValue.toFixed(2)})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-primary/10",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Predicted"}),e.jsx("p",{className:"text-lg font-bold text-primary",children:s.predictedValue.toFixed(2)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Confidence"}),e.jsxs("span",{className:"font-medium",children:[s.confidence,"%"]})]}),e.jsx(fe,{value:s.confidence,className:"h-1.5"})]})]})},t))})}),e.jsx(z,{value:"patterns",className:"mt-4",children:e.jsx("div",{className:"space-y-4",children:C.map((s,t)=>e.jsx(w,{children:e.jsx(y,{className:"py-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${s.type==="trend"?"bg-blue-500/10 text-blue-500":s.type==="correlation"?"bg-purple-500/10 text-purple-500":s.type==="seasonality"?"bg-orange-500/10 text-orange-500":"bg-green-500/10 text-green-500"}`,children:[s.type==="trend"&&e.jsx(H,{className:"h-4 w-4"}),s.type==="correlation"&&e.jsx(E,{className:"h-4 w-4"}),s.type==="seasonality"&&e.jsx(Z,{className:"h-4 w-4"}),s.type==="cluster"&&e.jsx(I,{className:"h-4 w-4"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.title}),e.jsxs(v,{variant:"secondary",className:"text-xs",children:[s.confidence.toFixed(0),"% confidence"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.affectedColumns.map((n,a)=>e.jsx(v,{variant:"outline",className:"text-xs",children:n},a))})]})]})})},t))})})]})]})};export{$e as default};
