import{g as A,h as Te,r as o,s as j,j as e,a as T,b as B,M as F,c as W,x as Y,d as D,G as De,H as Me,J as q,P as te,S as ye,K as P,B as m,f as M,D as c,I as i,aD as $e,L as I,v as Ne,aE as Ie,am as Oe,ar as we,o as Ee,u,Z as Qe,aF as Le,aG as Re,w as He,al as _e,A as Ue,az as ze,aH as x}from"./index-CG6I4ibZ.js";import{S as Z,a as X,b as ee,c as se,d as v}from"./select-BnHOLFni.js";import{S as fe}from"./switch-buUSdwhU.js";import{T as Je}from"./textarea-CvW_5S27.js";import{S as Ve}from"./server-BKa2ndd6.js";import{T as be}from"./trash-2-GddBIG4P.js";import{E as Ge}from"./eye-BitIfH2z.js";import{S as Ke}from"./save-hs18GGHj.js";import{R as Fe}from"./refresh-cw-asTtkkCL.js";import{C as ae}from"./clock-JgIc6NIT.js";import{C as qe}from"./calendar-DRGLsduc.js";import{T as Be}from"./trending-up-Dqe0U41A.js";import"./index-DXJAGtlO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=A("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=A("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=A("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=A("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=A("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=A("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=A("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),ss={postgresql:5432,mysql:3306,sqlite:0,mongodb:27017},ve=[{value:"postgresql",label:"PostgreSQL",icon:"ðŸ˜"},{value:"mysql",label:"MySQL",icon:"ðŸ¬"},{value:"sqlite",label:"SQLite",icon:"ðŸ“¦"},{value:"mongodb",label:"MongoDB",icon:"ðŸƒ"}],as=({onDataLoaded:E})=>{var a;const{user:f}=Te(),[y,L]=o.useState([]),[d,b]=o.useState(null),[g,w]=o.useState(!1),[H,U]=o.useState(!1),[S,C]=o.useState(!1),[he,$]=o.useState("connections"),[r,l]=o.useState({name:"",db_type:"postgresql",host:"",port:5432,database_name:"",username:"",password:"",ssl_enabled:!0}),[O,Q]=o.useState(""),[p,k]=o.useState(""),[z,J]=o.useState(""),[V,G]=o.useState(!1),[_,ne]=o.useState(null),[R,re]=o.useState([]),[Se,me]=o.useState(null),[Ce,ke]=o.useState(null);o.useEffect(()=>{f&&K()},[f]);const K=async()=>{const{data:s,error:n}=await j.from("database_connections").select("*").order("created_at",{ascending:!1});if(n){console.error("Failed to load connections:",n);return}L(s||[])},ue=s=>{l(n=>({...n,db_type:s,port:ss[s]||5432}))},ce=async()=>{U(!0);try{const{data:s,error:n}=await j.functions.invoke("db-connect",{body:{action:"test",connection:r}});if(n)throw n;s.success?(u.success(s.message),s.tables&&re(s.tables)):u.error(s.message||"Connection test failed")}catch(s){u.error(s instanceof Error?s.message:"Connection test failed")}finally{U(!1)}},xe=async()=>{if(!r.name||!r.host||!r.database_name||!r.username||!r.password){u.error("Please fill in all required fields");return}w(!0);try{const{data:s,error:n}=await j.functions.invoke("db-connect",{body:{action:"save",connection:r}});if(n)throw n;s.success?(u.success("Connection saved successfully"),K(),l({name:"",db_type:"postgresql",host:"",port:5432,database_name:"",username:"",password:"",ssl_enabled:!0}),$("connections")):u.error(s.error||"Failed to save connection")}catch(s){u.error(s instanceof Error?s.message:"Failed to save connection")}finally{w(!1)}},pe=async s=>{try{const{error:n}=await j.functions.invoke("db-connect",{body:{action:"delete",connectionId:s}});if(n)throw n;u.success("Connection deleted"),K(),(d==null?void 0:d.id)===s&&b(null)}catch(n){u.error(n instanceof Error?n.message:"Failed to delete connection")}},je=async s=>{b(s),$("query");try{const{data:n}=await j.functions.invoke("db-connect",{body:{action:"list-tables",connectionId:s.id}});n!=null&&n.tables&&re(n.tables)}catch(n){console.error("Failed to load tables:",n)}},le=async()=>{if(!O.trim()){u.error("Please enter a query");return}if(!d){u.error("Please select a database connection first");return}G(!0);try{const{data:s,error:n}=await j.functions.invoke("db-connect",{body:{action:"nl-query",connectionId:d.id,naturalLanguageQuery:O,tableContext:R}});if(n)throw n;s.success?(k(s.sql),J(s.explanation),u.success("SQL generated successfully")):u.error(s.error||"Failed to generate SQL")}catch(s){u.error(s instanceof Error?s.message:"Failed to generate SQL")}finally{G(!1)}},ie=async()=>{var s;if(!p.trim()){u.error("No SQL to execute");return}w(!0);try{const{data:n,error:h}=await j.functions.invoke("db-connect",{body:{action:"query",connectionId:d==null?void 0:d.id,sql:p}});if(h)throw h;n.success?(ne(n.results||[]),u.success(`Query executed. ${n.rowCount||0} rows returned.`),((s=n.results)==null?void 0:s.length)>0&&E&&E({name:`Query Result - ${new Date().toLocaleString()}`,rawData:n.results,columns:Object.keys(n.results[0]||{}),status:"uploaded"})):u.error(n.error||"Query execution failed")}catch(n){u.error(n instanceof Error?n.message:"Query execution failed")}finally{w(!1)}},t=s=>{navigator.clipboard.writeText(s),u.success("Copied to clipboard")};return e.jsx("div",{className:"space-y-6",children:e.jsxs(T,{className:"premium-card",children:[e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(F,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(W,{className:"text-lg",children:"Database Connections"}),e.jsx(Y,{children:"Connect to external databases and query with natural language"})]})]})}),e.jsx(D,{children:e.jsxs(De,{value:he,onValueChange:$,children:[e.jsxs(Me,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(q,{value:"connections",className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Connections"]}),e.jsxs(q,{value:"new",className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"New Connection"]}),e.jsxs(q,{value:"query",className:"flex items-center gap-2",disabled:!d,children:[e.jsx(ye,{className:"h-4 w-4"}),"Query"]})]}),e.jsx(P,{value:"connections",className:"space-y-4",children:y.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(F,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No database connections yet"}),e.jsxs(m,{variant:"outline",className:"mt-4",onClick:()=>$("new"),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Connection"]})]}):e.jsx("div",{className:"grid gap-4",children:y.map(s=>{var n;return e.jsx(T,{className:`cursor-pointer transition-all hover:border-primary/50 ${(d==null?void 0:d.id)===s.id?"border-primary bg-primary/5":""}`,onClick:()=>je(s),children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:((n=ve.find(h=>h.value===s.db_type))==null?void 0:n.icon)||"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.host,":",s.port," / ",s.database_name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:s.connection_status==="active"?"default":"secondary",children:s.connection_status}),e.jsx(m,{variant:"ghost",size:"icon",onClick:h=>{h.stopPropagation(),pe(s.id)},children:e.jsx(be,{className:"h-4 w-4 text-destructive"})})]})]})})},s.id)})})}),e.jsxs(P,{value:"new",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name *"}),e.jsx(i,{placeholder:"My Production DB",value:r.name,onChange:s=>l(n=>({...n,name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Database Type *"}),e.jsxs(Z,{value:r.db_type,onValueChange:ue,children:[e.jsx(X,{children:e.jsx(ee,{})}),e.jsx(se,{className:"bg-popover",children:ve.map(s=>e.jsx(v,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]})},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Host *"}),e.jsx(i,{placeholder:"localhost or db.example.com",value:r.host,onChange:s=>l(n=>({...n,host:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Port *"}),e.jsx(i,{type:"number",value:r.port,onChange:s=>l(n=>({...n,port:parseInt(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Database Name *"}),e.jsx(i,{placeholder:"mydb",value:r.database_name,onChange:s=>l(n=>({...n,database_name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Username *"}),e.jsx(i,{placeholder:"postgres",value:r.username,onChange:s=>l(n=>({...n,username:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(c,{children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{type:S?"text":"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:r.password,onChange:s=>l(n=>({...n,password:s.target.value})),className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full",onClick:()=>C(!S),children:S?e.jsx(Ye,{className:"h-4 w-4"}):e.jsx(Ge,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{id:"ssl",checked:r.ssl_enabled,onCheckedChange:s=>l(n=>({...n,ssl_enabled:s}))}),e.jsxs(c,{htmlFor:"ssl",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx($e,{className:"h-4 w-4"}),"Enable SSL"]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsxs(m,{variant:"outline",onClick:ce,disabled:H,children:[H?e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Test Connection"]}),e.jsxs(m,{onClick:xe,disabled:g,children:[g?e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Save Connection"]})]})]}),e.jsx(P,{value:"query",className:"space-y-6",children:d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:(a=ve.find(s=>s.value===d.db_type))==null?void 0:a.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:d.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.host,":",d.port]})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>b(null),children:"Change"})]}),R.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Available Tables"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(s=>e.jsx(M,{variant:"outline",className:"cursor-pointer hover:bg-primary/10",onClick:()=>me(s),children:s},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-primary"}),"Ask a question about your data"]}),e.jsx(Je,{placeholder:"e.g., Show me the top 10 customers by total revenue",value:O,onChange:s=>Q(s.target.value),className:"min-h-[80px]"}),e.jsxs(m,{onClick:le,disabled:V,children:[V?e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Generate SQL"]})]}),p&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{children:"Generated SQL"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>t(p),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Copy"]})]}),e.jsx("div",{className:"relative",children:e.jsx("pre",{className:"p-4 bg-muted/50 rounded-lg overflow-x-auto text-sm font-mono",children:p})}),z&&e.jsx("p",{className:"text-sm text-muted-foreground italic",children:z}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(m,{onClick:ie,disabled:g,children:[g?e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(we,{className:"h-4 w-4 mr-2"}),"Execute Query"]}),e.jsxs(m,{variant:"outline",onClick:()=>{k(""),J(""),Q("")},children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Clear"]})]})]}),_&&_.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{children:["Results (",_.length," rows)"]}),e.jsx(Ee,{className:"h-[300px] border rounded-lg",children:e.jsx("div",{className:"p-4",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b",children:Object.keys(_[0]).map(s=>e.jsx("th",{className:"text-left p-2 font-medium",children:s},s))})}),e.jsx("tbody",{children:_.slice(0,100).map((s,n)=>e.jsx("tr",{className:"border-b border-border/50",children:Object.values(s).map((h,N)=>e.jsx("td",{className:"p-2",children:String(h)},N))},n))})]})})})]})]})})]})})]})})},de=[{name:"Google Sheets",type:"google_sheets",icon:Re,description:"Import data directly from Google Sheets"},{name:"CSV URL",type:"csv_url",icon:Le,description:"Fetch CSV data from any public URL"},{name:"JSON API",type:"json_api",icon:Ze,description:"Connect to REST APIs returning JSON"},{name:"Database",type:"database",icon:F,description:"Connect to PostgreSQL, MySQL, or SQLite"},{name:"Webhook",type:"webhook",icon:es,description:"Receive data via webhook endpoint"},{name:"Amazon S3",type:"s3",icon:We,description:"Import files from S3 buckets"},{name:"Airtable",type:"airtable",icon:Ie,description:"Sync data from Airtable bases"},{name:"Notion",type:"notion",icon:He,description:"Import databases from Notion"}],ts=[{value:"manual",label:"Manual",description:"Run manually when needed",icon:we},{value:"hourly",label:"Every Hour",description:"Sync automatically every hour",icon:ae},{value:"daily",label:"Daily",description:"Sync once per day at midnight",icon:qe},{value:"weekly",label:"Weekly",description:"Sync once per week",icon:Pe}],gs=({onDataLoaded:E})=>{var ie;const{user:f}=Te(),[y,L]=o.useState([]),[d,b]=o.useState([]),[g,w]=o.useState(null),[H,U]=o.useState(!1),[S,C]=o.useState(null),[he,$]=o.useState("connectors"),[r,l]=o.useState({}),[O,Q]=o.useState(!1),[p,k]=o.useState({name:"",connectorId:"",scheduleType:"manual"}),[z,J]=o.useState(!1),[V,G]=o.useState([]),[_,ne]=o.useState(null);o.useEffect(()=>{f&&R()},[f]);const R=async()=>{if(!f)return;const{data:t,error:a}=await j.from("scheduled_jobs").select("*").order("created_at",{ascending:!1});if(a){console.error("Error loading scheduled jobs:",a);return}b((t||[]).map(s=>({...s,connector_config:s.connector_config,schedule_type:s.schedule_type})))},re=async()=>{if(!g)return;U(!0),await new Promise(s=>setTimeout(s,1500));const t=de.find(s=>s.type===g);if(!t)return;const a={id:`connector_${Date.now()}`,name:r.name||t.name,type:g,icon:t.icon,description:t.description,status:"connected",config:{...r},lastSync:new Date().toISOString()};L(s=>[...s,a]),l({}),w(null),U(!1),x({title:"Connector Added",description:`${a.name} has been connected successfully.`})},Se=async t=>{C(t);const a=y.find(s=>s.id===t);if(a)try{if(["google_sheets","csv_url","json_api","airtable","notion","webhook","s3"].includes(a.type)){const{data:n,error:h}=await j.functions.invoke("fetch-connector-data",{body:{type:a.type,config:{...a.config,tableId:a.config.tableName,apiKey:a.config.apiKey||a.config.token}}});if(h)throw new Error(h.message||"Failed to fetch data");if(!n.success)throw new Error(n.error||"Failed to fetch data from connector");const N=n.data;L(Ae=>Ae.map(ge=>ge.id===t?{...ge,lastSync:new Date().toISOString(),status:"connected"}:ge)),C(null),E({name:`${a.name} Import`,rawData:N,columns:n.columns||Object.keys(N[0]||{}),status:"imported"}),x({title:"Data Synced Successfully",description:`${N.length} records imported from ${a.name}.`})}else{await new Promise(h=>setTimeout(h,1500));const n=pe(a.type);L(h=>h.map(N=>N.id===t?{...N,lastSync:new Date().toISOString()}:N)),C(null),E({name:`${a.name} Import`,rawData:n,columns:Object.keys(n[0]||{}),status:"imported"}),x({title:"Data Synced (Demo)",description:`${n.length} sample records loaded.`})}}catch(s){console.error("Sync error:",s),L(n=>n.map(h=>h.id===t?{...h,status:"error"}:h)),C(null),x({title:"Sync Failed",description:s instanceof Error?s.message:"Failed to sync data",variant:"destructive"})}},me=t=>{L(a=>a.filter(s=>s.id!==t)),x({title:"Connector Removed",description:"Data connector has been disconnected."})},Ce=async()=>{if(!f){x({title:"Please sign in",description:"You need to be signed in to create scheduled jobs.",variant:"destructive"});return}const t=y.find(a=>a.id===p.connectorId);if(!t){x({title:"Select a connector",description:"Please select a data source for the schedule.",variant:"destructive"});return}if(!p.name.trim()){x({title:"Enter a name",description:"Please enter a name for the scheduled job.",variant:"destructive"});return}J(!0);try{const a=xe(p.scheduleType),{data:s,error:n}=await j.from("scheduled_jobs").insert({user_id:f.id,name:p.name,connector_type:t.type,connector_config:t.config,schedule_type:p.scheduleType,is_active:!0,next_run_at:a.toISOString()}).select().single();if(n)throw n;b(h=>[{...s,connector_config:s.connector_config,schedule_type:s.schedule_type},...h]),Q(!1),k({name:"",connectorId:"",scheduleType:"manual"}),x({title:"Schedule Created",description:`${p.name} will sync ${p.scheduleType==="manual"?"manually":p.scheduleType}.`})}catch(a){console.error("Error creating schedule:",a),x({title:"Failed to create schedule",description:a instanceof Error?a.message:"Unknown error",variant:"destructive"})}finally{J(!1)}},ke=async(t,a)=>{const{error:s}=await j.from("scheduled_jobs").update({is_active:a}).eq("id",t);if(s){x({title:"Failed to update",description:s.message,variant:"destructive"});return}b(n=>n.map(h=>h.id===t?{...h,is_active:a}:h)),x({title:a?"Schedule Activated":"Schedule Paused",description:a?"Job will run on schedule.":"Job has been paused."})},K=async t=>{C(t.id);try{const{data:a,error:s}=await j.functions.invoke("scheduled-sync",{body:{action:"run_job",jobId:t.id}});if(s)throw new Error(s.message);if(!a.success)throw new Error(a.error);const n=a.data;E({name:`${t.name} Sync`,rawData:n,columns:a.columns||Object.keys(n[0]||{}),status:"imported"}),await R(),x({title:"Sync Complete",description:`${n.length} records synced in ${a.executionTime}ms.`})}catch(a){console.error("Error running job:",a),x({title:"Sync Failed",description:a instanceof Error?a.message:"Unknown error",variant:"destructive"})}finally{C(null)}},ue=async t=>{const{error:a}=await j.from("scheduled_jobs").delete().eq("id",t);if(a){x({title:"Failed to delete",description:a.message,variant:"destructive"});return}b(s=>s.filter(n=>n.id!==t)),x({title:"Schedule Deleted",description:"The scheduled job has been removed."})},ce=async t=>{ne(t);try{const{data:a,error:s}=await j.functions.invoke("scheduled-sync",{body:{action:"get_history",jobId:t}});if(s)throw new Error(s.message);G(a.history||[])}catch(a){console.error("Error fetching history:",a),x({title:"Failed to load history",description:a instanceof Error?a.message:"Unknown error",variant:"destructive"})}},xe=t=>{const a=new Date;switch(t){case"hourly":return new Date(a.getTime()+60*60*1e3);case"daily":const s=new Date(a);return s.setDate(s.getDate()+1),s.setHours(0,0,0,0),s;case"weekly":const n=new Date(a);return n.setDate(n.getDate()+7),n.setHours(0,0,0,0),n;default:return a}},pe=t=>{const a=Array.from({length:50},(s,n)=>({id:n+1,created_at:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()}));switch(t){case"google_sheets":return a.map(s=>({...s,name:`Product ${s.id}`,category:["Electronics","Clothing","Food","Home"][Math.floor(Math.random()*4)],price:Math.round(Math.random()*500+10),quantity:Math.floor(Math.random()*100),revenue:Math.round(Math.random()*1e4)}));case"json_api":return a.map(s=>({...s,user_id:`user_${Math.floor(Math.random()*1e3)}`,event_type:["click","view","purchase","signup"][Math.floor(Math.random()*4)],value:Math.round(Math.random()*100),session_duration:Math.floor(Math.random()*3600)}));case"database":return a.map(s=>({...s,customer_name:`Customer ${s.id}`,email:`customer${s.id}@example.com`,total_orders:Math.floor(Math.random()*50),lifetime_value:Math.round(Math.random()*5e3),status:["active","inactive","pending"][Math.floor(Math.random()*3)]}));default:return a.map(s=>({...s,metric:Math.round(Math.random()*1e3),label:`Item ${s.id}`,value:Math.random()*100}))}},je=()=>g&&{google_sheets:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My Google Sheet",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Spreadsheet URL"}),e.jsx(i,{placeholder:"https://docs.google.com/spreadsheets/d/...",value:r.url||"",onChange:a=>l(s=>({...s,url:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Sheet Name (optional)"}),e.jsx(i,{placeholder:"Sheet1",value:r.sheet||"",onChange:a=>l(s=>({...s,sheet:a.target.value}))})]})]}),csv_url:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My CSV Data",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"CSV URL"}),e.jsx(i,{placeholder:"https://example.com/data.csv",value:r.url||"",onChange:a=>l(s=>({...s,url:a.target.value}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{checked:r.hasHeaders==="true",onCheckedChange:a=>l(s=>({...s,hasHeaders:String(a)}))}),e.jsx(c,{children:"First row contains headers"})]})]}),json_api:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My API Connection",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"API Endpoint URL"}),e.jsx(i,{placeholder:"https://api.example.com/data",value:r.url||"",onChange:a=>l(s=>({...s,url:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"HTTP Method"}),e.jsxs(Z,{value:r.method||"GET",onValueChange:a=>l(s=>({...s,method:a})),children:[e.jsx(X,{children:e.jsx(ee,{placeholder:"Select method"})}),e.jsxs(se,{children:[e.jsx(v,{value:"GET",children:"GET"}),e.jsx(v,{value:"POST",children:"POST"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"API Key (optional)"}),e.jsx(i,{type:"password",placeholder:"Your API key",value:r.apiKey||"",onChange:a=>l(s=>({...s,apiKey:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"JSON Path (optional)"}),e.jsx(i,{placeholder:"data.items",value:r.jsonPath||"",onChange:a=>l(s=>({...s,jsonPath:a.target.value}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Path to the array in the JSON response"})]})]}),database:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My Database",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Database Type"}),e.jsxs(Z,{value:r.dbType||"",onValueChange:a=>l(s=>({...s,dbType:a})),children:[e.jsx(X,{children:e.jsx(ee,{placeholder:"Select database"})}),e.jsxs(se,{children:[e.jsx(v,{value:"postgresql",children:"PostgreSQL"}),e.jsx(v,{value:"mysql",children:"MySQL"}),e.jsx(v,{value:"sqlite",children:"SQLite"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection String"}),e.jsx(i,{type:"password",placeholder:"postgresql://user:pass@host:5432/db",value:r.connectionString||"",onChange:a=>l(s=>({...s,connectionString:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Query"}),e.jsx(i,{placeholder:"SELECT * FROM table_name",value:r.query||"",onChange:a=>l(s=>({...s,query:a.target.value}))})]})]}),webhook:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My Webhook",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Webhook ID"}),e.jsx(i,{placeholder:"unique-webhook-id",value:r.webhookId||"",onChange:a=>l(s=>({...s,webhookId:a.target.value.toLowerCase().replace(/\s+/g,"-")}))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use a unique identifier for your webhook"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 border border-border",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Your Webhook URL"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs bg-background px-2 py-1 rounded break-all flex-1",children:`https://ejchqqvaycugslbaxspn.supabase.co/functions/v1/webhook-receiver/${r.webhookId||"your-webhook-id"}`}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(`https://ejchqqvaycugslbaxspn.supabase.co/functions/v1/webhook-receiver/${r.webhookId||"your-webhook-id"}`),x({title:"Copied!",description:"Webhook URL copied to clipboard"})},children:"Copy"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Send POST requests with JSON data to this URL"})]})]}),s3:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My S3 Bucket",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Bucket Name"}),e.jsx(i,{placeholder:"my-bucket",value:r.bucket||"",onChange:a=>l(s=>({...s,bucket:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Region"}),e.jsxs(Z,{value:r.region||"",onValueChange:a=>l(s=>({...s,region:a})),children:[e.jsx(X,{children:e.jsx(ee,{placeholder:"Select region"})}),e.jsxs(se,{children:[e.jsx(v,{value:"us-east-1",children:"US East (N. Virginia)"}),e.jsx(v,{value:"us-west-2",children:"US West (Oregon)"}),e.jsx(v,{value:"eu-west-1",children:"EU (Ireland)"}),e.jsx(v,{value:"ap-southeast-1",children:"Asia Pacific (Singapore)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Access Key ID"}),e.jsx(i,{type:"password",placeholder:"AKIA...",value:r.accessKey||"",onChange:a=>l(s=>({...s,accessKey:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Secret Access Key"}),e.jsx(i,{type:"password",placeholder:"Your secret key",value:r.secretKey||"",onChange:a=>l(s=>({...s,secretKey:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"File Path/Prefix"}),e.jsx(i,{placeholder:"data/exports/",value:r.prefix||"",onChange:a=>l(s=>({...s,prefix:a.target.value}))})]})]}),airtable:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My Airtable Base",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"API Key"}),e.jsx(i,{type:"password",placeholder:"key...",value:r.apiKey||"",onChange:a=>l(s=>({...s,apiKey:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Base ID"}),e.jsx(i,{placeholder:"app...",value:r.baseId||"",onChange:a=>l(s=>({...s,baseId:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Table Name"}),e.jsx(i,{placeholder:"Table 1",value:r.tableName||"",onChange:a=>l(s=>({...s,tableName:a.target.value}))})]})]}),notion:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Connection Name"}),e.jsx(i,{placeholder:"My Notion Database",value:r.name||"",onChange:a=>l(s=>({...s,name:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Integration Token"}),e.jsx(i,{type:"password",placeholder:"secret_...",value:r.token||"",onChange:a=>l(s=>({...s,token:a.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Database ID"}),e.jsx(i,{placeholder:"Database ID from URL",value:r.databaseId||"",onChange:a=>l(s=>({...s,databaseId:a.target.value}))})]})]})}[g]||null,le=t=>{const a=de.find(s=>s.type===t);return(a==null?void 0:a.icon)||F};return e.jsx("div",{className:"space-y-6",children:e.jsxs(T,{className:"border-border shadow-card",children:[e.jsx(B,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-primary"}),"Smart Data Connectors & Scheduling"]}),e.jsx(Y,{children:"Connect to external sources with intelligent auto-sync scheduling"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"secondary",className:"gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),y.filter(t=>t.status==="connected").length," Connected"]}),e.jsxs(M,{variant:"outline",className:"gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),d.filter(t=>t.is_active).length," Active Schedules"]})]})]})}),e.jsx(D,{className:"p-6",children:e.jsxs(De,{value:he,onValueChange:$,children:[e.jsxs(Me,{className:"grid grid-cols-4 w-full max-w-2xl mb-6",children:[e.jsxs(q,{value:"connectors",className:"gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),"Connectors"]}),e.jsxs(q,{value:"database",className:"gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Database"]}),e.jsxs(q,{value:"schedules",className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Schedules"]}),e.jsxs(q,{value:"history",className:"gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"History"]})]}),e.jsxs(P,{value:"connectors",className:"space-y-6",children:[e.jsxs(T,{className:"border-dashed border-2 border-border bg-muted/30",children:[e.jsxs(B,{children:[e.jsxs(W,{className:"text-lg flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Add Data Connector"]}),e.jsx(Y,{children:"Choose a data source to connect"})]}),e.jsx(D,{children:g?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-primary/10 border border-primary/20",children:(()=>{const t=de.find(s=>s.type===g),a=(t==null?void 0:t.icon)||F;return e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t==null?void 0:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t==null?void 0:t.description})]})]})})()}),je(),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:()=>{w(null),l({})},children:"Cancel"}),e.jsx(m,{onClick:re,disabled:H,className:"gap-2",children:H?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Connect"]})})]})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:de.map(t=>{const a=t.icon;return e.jsxs("button",{onClick:()=>w(t.type),className:"flex flex-col items-center gap-2 p-4 rounded-xl border border-border bg-card hover:bg-accent/50 hover:border-primary/50 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(a,{className:"w-5 h-5 text-primary"})}),e.jsx("span",{className:"text-sm font-medium text-center",children:t.name})]},t.type)})})})]}),y.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Connected Sources"}),e.jsx("div",{className:"grid gap-4",children:y.map(t=>{const a=t.icon;return e.jsx(T,{className:"border-border",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(a,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsx(M,{variant:t.status==="connected"?"default":"destructive",className:"text-xs",children:t.status==="connected"?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Connected"]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-3 h-3 mr-1"}),"Error"]})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.lastSync?`Last synced: ${new Date(t.lastSync).toLocaleString()}`:"Never synced"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Se(t.id),disabled:S===t.id,className:"gap-2",children:S===t.id?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-4 h-4"}),"Sync Now"]})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>me(t.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(be,{className:"w-4 h-4"})})]})]})})},t.id)})})]}),y.length===0&&!g&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No data connectors configured yet."}),e.jsx("p",{className:"text-sm",children:"Add a connector above to import data from external sources."})]})]}),e.jsx(P,{value:"database",className:"space-y-6",children:e.jsx(as,{onDataLoaded:E})}),e.jsxs(P,{value:"schedules",className:"space-y-6",children:[e.jsxs(T,{className:"border-dashed border-2 border-border bg-muted/30",children:[e.jsxs(B,{children:[e.jsxs(W,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Create Scheduled Sync"]}),e.jsx(Y,{children:"Set up automatic data synchronization at regular intervals"})]}),e.jsxs(D,{children:[O?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Schedule Name"}),e.jsx(i,{placeholder:"Daily Sales Sync",value:p.name,onChange:t=>k(a=>({...a,name:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Data Source"}),e.jsxs(Z,{value:p.connectorId,onValueChange:t=>k(a=>({...a,connectorId:t})),children:[e.jsx(X,{children:e.jsx(ee,{placeholder:"Select a connected source"})}),e.jsx(se,{children:y.map(t=>e.jsx(v,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.name]})},t.id))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Sync Frequency"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:ts.map(t=>{const a=t.icon,s=p.scheduleType===t.value;return e.jsxs("button",{onClick:()=>k(n=>({...n,scheduleType:t.value})),className:`flex flex-col items-center gap-2 p-4 rounded-xl border transition-all ${s?"border-primary bg-primary/10":"border-border bg-card hover:bg-accent/50"}`,children:[e.jsx(a,{className:`w-5 h-5 ${s?"text-primary":"text-muted-foreground"}`}),e.jsx("span",{className:"text-sm font-medium",children:t.label}),e.jsx("span",{className:"text-xs text-muted-foreground text-center",children:t.description})]},t.value)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:()=>{Q(!1),k({name:"",connectorId:"",scheduleType:"manual"})},children:"Cancel"}),e.jsx(m,{onClick:Ce,disabled:z,className:"gap-2",children:z?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4"}),"Create Schedule"]})})]})]}):e.jsxs(m,{onClick:()=>Q(!0),disabled:y.length===0,className:"gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"New Schedule"]}),y.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Add a connector first to create scheduled syncs."})]})]}),d.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Active Schedules"]}),e.jsx("div",{className:"grid gap-4",children:d.map(t=>{const a=le(t.connector_type);return e.jsx(T,{className:`border-border ${t.is_active?"":"opacity-60"}`,children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${t.is_active?"bg-primary/10":"bg-muted"}`,children:e.jsx(a,{className:`w-6 h-6 ${t.is_active?"text-primary":"text-muted-foreground"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsx(M,{variant:t.is_active?"default":"secondary",className:"text-xs",children:t.schedule_type==="manual"?"Manual":t.schedule_type.charAt(0).toUpperCase()+t.schedule_type.slice(1)}),t.last_run_status&&e.jsxs(M,{variant:t.last_run_status==="success"?"default":t.last_run_status==="failed"?"destructive":"secondary",className:"text-xs",children:[t.last_run_status==="success"?e.jsx(Ne,{className:"w-3 h-3 mr-1"}):t.last_run_status==="failed"?e.jsx(_e,{className:"w-3 h-3 mr-1"}):null,t.last_run_status]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[t.last_run_at&&e.jsxs("span",{children:["Last run: ",new Date(t.last_run_at).toLocaleString()]}),t.next_run_at&&t.is_active&&t.schedule_type!=="manual"&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),"Next: ",new Date(t.next_run_at).toLocaleString()]}),t.records_synced!==void 0&&t.records_synced>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3"}),t.records_synced," records"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{checked:t.is_active,onCheckedChange:s=>ke(t.id,s)}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>K(t),disabled:S===t.id,className:"gap-2",children:[S===t.id?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(we,{className:"w-4 h-4"}),"Run Now"]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>ce(t.id),className:"text-muted-foreground hover:text-foreground",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>ue(t.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(be,{className:"w-4 h-4"})})]})]})})},t.id)})})]}),d.length===0&&!O&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No scheduled syncs configured yet."}),e.jsx("p",{className:"text-sm",children:"Create a schedule to automatically sync your data sources."})]})]}),e.jsx(P,{value:"history",className:"space-y-6",children:e.jsxs(T,{children:[e.jsxs(B,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),"Sync History"]}),e.jsx(Y,{children:"View past synchronization runs and their results"})]}),e.jsx(D,{children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium",children:["History for: ",(ie=d.find(t=>t.id===_))==null?void 0:ie.name]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{ne(null),G([])},children:"Back"})]}),V.length>0?e.jsx(Ee,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-2",children:V.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{variant:t.status==="success"?"default":t.status==="failed"?"destructive":"secondary",children:t.status}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:new Date(t.started_at).toLocaleString()}),t.error_message&&e.jsx("p",{className:"text-xs text-destructive",children:t.error_message})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[t.records_synced!==void 0&&e.jsxs("span",{children:[t.records_synced," records"]}),t.execution_time_ms&&e.jsxs("span",{children:[t.execution_time_ms,"ms"]})]})]},t.id))})}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No history available for this job."})]}):e.jsx("div",{className:"space-y-4",children:d.length>0?e.jsx("div",{className:"grid gap-3",children:d.map(t=>{const a=le(t.connector_type);return e.jsxs("button",{onClick:()=>ce(t.id),className:"flex items-center justify-between p-4 rounded-lg border border-border hover:bg-accent/50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.last_run_at?`Last run: ${new Date(t.last_run_at).toLocaleString()}`:"Never run"})]})]}),e.jsx(ze,{className:"w-4 h-4 text-muted-foreground"})]},t.id)})}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(oe,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No sync history available."}),e.jsx("p",{className:"text-sm",children:"Create and run scheduled syncs to see history here."})]})})})]})})]})})]})})};export{gs as default};
