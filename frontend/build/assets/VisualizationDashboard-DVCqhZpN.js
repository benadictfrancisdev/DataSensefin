import{g as ze,j as e,a as w,b as k,c as D,d as C,n as je,r as A,v as we,e as Q,f as L,T as Le,w as Ce,x as se,A as he,C as W,y as Ze,z as be,t as ue,D as G,B as R,I as es,P as ss,u as H,S as ne,o as ts,U as as,k as ke,L as Me,p as rs,E as ve,G as Pe,H as Ie,J as O,K as B,M as Re,s as ns,N as ls,O as Ne,i as is,Q as cs,R as os,V as ds,W as ms,X as xs,Y as hs}from"./index-CG6I4ibZ.js";import{S as X,a as J,b as Z,c as ee,d as Y}from"./select-BnHOLFni.js";import{P as K}from"./progress-DcGcylKX.js";import{R as ie,C as ge,X as pe,Y as fe,T as ce,B as us,a as Ve,L as Se}from"./generateCategoricalChart-D2ZRUXeT.js";import{B as gs,S as ps,Z as fs,a as js}from"./ScatterChart-ChSpn_1T.js";import{L as Ns,a as bs,P as vs,b as ys,T as ws,D as Cs,S as Ss,F as As,C as Ue,H as Ee,c as Oe,M as ks}from"./PieChart-Ju6HBDVK.js";import{A as Ds,a as $s}from"./AreaChart-CF92B7rz.js";import{M as Ae}from"./minus-CKncxuHD.js";import{T as te}from"./trending-up-Dqe0U41A.js";import{T as le}from"./target-BeagzYB1.js";import{C as Be}from"./calendar-DRGLsduc.js";import{A as Ke,a as Ge}from"./arrow-up-right-DsX3IAhq.js";import{S as De}from"./switch-buUSdwhU.js";import{S as Ts}from"./slider-DR0xRu3K.js";import{P as He}from"./palette-BFgSVLTd.js";import{G as ye}from"./grid-3x3-DS8h7Fvg.js";import{S as $e}from"./save-hs18GGHj.js";import{R as Fs}from"./refresh-cw-asTtkkCL.js";import{T as zs}from"./trash-2-GddBIG4P.js";import{C as Ye}from"./chart-line-DVZvcpV3.js";import{T as Ls}from"./textarea-CvW_5S27.js";import{P as Ms,a as Ps,b as Is}from"./popover-DNDT6pWB.js";import{a as Rs}from"./api-DYyoPUUI.js";import"./index-DXJAGtlO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ze("ChartArea",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M7 11.207a.5.5 0 0 1 .146-.353l2-2a.5.5 0 0 1 .708 0l3.292 3.292a.5.5 0 0 0 .708 0l4.292-4.292a.5.5 0 0 1 .854.353V16a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1z",key:"q0gr47"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=ze("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),oe=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--chart-6))","hsl(var(--chart-7))","hsl(var(--chart-8))"],We=({data:g,xKey:d,yKey:h,title:v,color:y,showGrid:l=!0})=>{const x=g.slice(0,10).map((N,p)=>({name:String(N[d]||`Item ${p+1}`).slice(0,15),value:Number(N[h])||0})),m=({active:N,payload:p,label:i})=>N&&p&&p.length?e.jsxs("div",{className:"bg-card border border-border rounded-md px-3 py-2 shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:i}),e.jsx("p",{className:"text-sm font-semibold text-primary",children:p[0].value.toLocaleString()})]}):null;return e.jsxs(w,{className:"linear-card h-full",children:[e.jsx(k,{className:"pb-2 border-b border-border",children:e.jsxs(D,{className:"text-sm font-semibold text-foreground flex items-center justify-between",children:[v,e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:[x.length," items"]})]})}),e.jsxs(C,{className:"pt-4",children:[e.jsx(ie,{width:"100%",height:280,children:e.jsxs(gs,{data:x,margin:{top:10,right:10,left:-10,bottom:0},children:[l&&e.jsx(ge,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",vertical:!1}),e.jsx(pe,{dataKey:"name",tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"},tickLine:!1,dy:8}),e.jsx(fe,{tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:!1,tickLine:!1,dx:-5}),e.jsx(ce,{content:e.jsx(m,{}),cursor:{fill:"hsl(var(--muted))",opacity:.5}}),e.jsx(us,{dataKey:"value",radius:[4,4,0,0],maxBarSize:45,children:x.map((N,p)=>e.jsx(Ve,{fill:y||oe[p%oe.length],className:"transition-opacity duration-200 hover:opacity-80"},`cell-${p}`))})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4 pt-3 border-t border-border",children:[x.slice(0,5).map((N,p)=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:y||oe[p%oe.length]}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:N.name})]},p)),x.length>5&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",x.length-5," more"]})]})]})]})},de=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],_e=({data:g,xKey:d,yKeys:h,title:v,showGrid:y=!0})=>{const l=g.slice(0,20).map((m,N)=>({name:String(m[d]||`Point ${N+1}`).slice(0,12),...h.reduce((p,i)=>({...p,[i]:Number(m[i])||0}),{})})),x=({active:m,payload:N,label:p})=>m&&N&&N.length?e.jsxs("div",{className:"bg-card border border-border rounded-md px-3 py-2 shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-2 pb-2 border-b border-border",children:p}),N.map((i,r)=>e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:i.color}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.name})]}),e.jsx("span",{className:"text-xs font-semibold text-foreground",children:i.value.toLocaleString()})]},r))]}):null;return e.jsxs(w,{className:"linear-card h-full",children:[e.jsx(k,{className:"pb-2 border-b border-border",children:e.jsxs(D,{className:"text-sm font-semibold text-foreground flex items-center justify-between",children:[v,e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:[l.length," points"]})]})}),e.jsx(C,{className:"pt-4",children:e.jsx(ie,{width:"100%",height:280,children:e.jsxs(Ns,{data:l,margin:{top:10,right:10,left:-10,bottom:0},children:[y&&e.jsx(ge,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",vertical:!1}),e.jsx(pe,{dataKey:"name",tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"},tickLine:!1,dy:8}),e.jsx(fe,{tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:!1,tickLine:!1,dx:-5}),e.jsx(ce,{content:e.jsx(x,{})}),e.jsx(Se,{wrapperStyle:{fontSize:11,paddingTop:16},iconType:"line",iconSize:16,formatter:m=>e.jsx("span",{className:"text-muted-foreground",children:m})}),h.map((m,N)=>e.jsx(bs,{type:"monotone",dataKey:m,stroke:de[N%de.length],strokeWidth:2,dot:!1,activeDot:{r:4,stroke:de[N%de.length],strokeWidth:2,fill:"hsl(var(--background))"}},m))]})})})]})},Te=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--chart-6))","hsl(var(--chart-7))","hsl(var(--chart-8))"],qe=({data:g,valueKey:d,nameKey:h,title:v})=>{const y=g.reduce((p,i)=>{const r=String(i[h]||"Other");return p[r]=(p[r]||0)+(Number(i[d])||1),p},{}),l=Object.entries(y).slice(0,8).map(([p,i])=>({name:p.slice(0,15),value:i})),x=l.reduce((p,i)=>p+i.value,0),m=({active:p,payload:i})=>{if(p&&i&&i.length){const r=(i[0].value/x*100).toFixed(1);return e.jsxs("div",{className:"bg-card border border-border rounded-md px-3 py-2 shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:i[0].name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:i[0].value.toLocaleString()}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",r,"%)"]})]})]})}return null},N=({cx:p,cy:i,midAngle:r,innerRadius:u,outerRadius:f,percent:j})=>{if(j<.05)return null;const b=Math.PI/180,a=u+(f-u)*.5,o=p+a*Math.cos(-r*b),S=i+a*Math.sin(-r*b);return e.jsx("text",{x:o,y:S,fill:"white",textAnchor:"middle",dominantBaseline:"central",className:"text-xs font-medium",style:{textShadow:"0 1px 2px rgba(0,0,0,0.3)"},children:`${(j*100).toFixed(0)}%`})};return e.jsxs(w,{className:"linear-card h-full",children:[e.jsx(k,{className:"pb-2 border-b border-border",children:e.jsxs(D,{className:"text-sm font-semibold text-foreground flex items-center justify-between",children:[v,e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:[l.length," categories"]})]})}),e.jsx(C,{className:"pt-4",children:e.jsx(ie,{width:"100%",height:280,children:e.jsxs(vs,{children:[e.jsx(ys,{data:l,cx:"50%",cy:"45%",innerRadius:50,outerRadius:85,paddingAngle:2,dataKey:"value",labelLine:!1,label:N,animationDuration:600,animationEasing:"ease-out",children:l.map((p,i)=>e.jsx(Ve,{fill:Te[i%Te.length],stroke:"hsl(var(--background))",strokeWidth:2,className:"transition-opacity duration-200 hover:opacity-80"},`cell-${i}`))}),e.jsx(ce,{content:e.jsx(m,{})}),e.jsx(Se,{wrapperStyle:{fontSize:11,paddingTop:8},formatter:p=>e.jsx("span",{className:"text-muted-foreground text-xs",children:p}),iconType:"circle",iconSize:8})]})})})]})},me=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],Xe=({data:g,xKey:d,yKeys:h,yKey:v,title:y,showGrid:l=!0,stacked:x=!1})=>{const m=h||(v?[v]:[]),N=g.slice(0,30).map((i,r)=>({name:String(i[d]||`Point ${r+1}`).slice(0,12),...m.reduce((u,f)=>({...u,[f]:Number(i[f])||0}),{})})),p=({active:i,payload:r,label:u})=>i&&r&&r.length?e.jsxs("div",{className:"bg-card border border-border rounded-md px-3 py-2 shadow-lg",children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-2 pb-2 border-b border-border",children:u}),r.map((f,j)=>e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:f.color}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:f.name})]}),e.jsx("span",{className:"text-xs font-semibold text-foreground",children:f.value.toLocaleString()})]},j))]}):null;return e.jsxs(w,{className:"linear-card h-full",children:[e.jsx(k,{className:"pb-2 border-b border-border",children:e.jsxs(D,{className:"text-sm font-semibold text-foreground flex items-center justify-between",children:[y,e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:[N.length," points"]})]})}),e.jsx(C,{className:"pt-4",children:e.jsx(ie,{width:"100%",height:280,children:e.jsxs(Ds,{data:N,margin:{top:10,right:10,left:-10,bottom:0},children:[e.jsx("defs",{children:me.map((i,r)=>e.jsxs("linearGradient",{id:`areaGrad${r}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:i,stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:i,stopOpacity:.05})]},r))}),l&&e.jsx(ge,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",vertical:!1}),e.jsx(pe,{dataKey:"name",tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"},tickLine:!1,dy:8}),e.jsx(fe,{tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:!1,tickLine:!1,dx:-5}),e.jsx(ce,{content:e.jsx(p,{})}),m.length>1&&e.jsx(Se,{wrapperStyle:{fontSize:11,paddingTop:16},iconType:"square",iconSize:10,formatter:i=>e.jsx("span",{className:"text-muted-foreground",children:i})}),m.map((i,r)=>e.jsx($s,{type:"monotone",dataKey:i,stroke:me[r%me.length],strokeWidth:2,fill:`url(#areaGrad${r%me.length})`,stackId:x?"1":void 0},i))]})})})]})},Je=({data:g,xKey:d,yKey:h,title:v,showGrid:y=!0})=>{const l=g.slice(0,50).map(m=>({x:Number(m[d])||0,y:Number(m[h])||0,z:100})),x=({active:m,payload:N})=>m&&N&&N.length?e.jsxs("div",{className:"bg-card border border-border rounded-md px-3 py-2 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:d}),e.jsx("span",{className:"text-xs font-semibold text-foreground",children:N[0].payload.x.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:h}),e.jsx("span",{className:"text-xs font-semibold text-foreground",children:N[0].payload.y.toLocaleString()})]})]}):null;return e.jsxs(w,{className:"linear-card h-full",children:[e.jsx(k,{className:"pb-2 border-b border-border",children:e.jsxs(D,{className:"text-sm font-semibold text-foreground flex items-center justify-between",children:[v,e.jsxs("span",{className:"text-xs font-normal text-muted-foreground",children:[l.length," points"]})]})}),e.jsxs(C,{className:"pt-4",children:[e.jsx(ie,{width:"100%",height:280,children:e.jsxs(ps,{margin:{top:10,right:10,left:-10,bottom:0},children:[y&&e.jsx(ge,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(pe,{type:"number",dataKey:"x",name:d,tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"},tickLine:!1,dy:8}),e.jsx(fe,{type:"number",dataKey:"y",name:h,tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:!1,tickLine:!1,dx:-5}),e.jsx(fs,{type:"number",dataKey:"z",range:[40,120]}),e.jsx(ce,{content:e.jsx(x,{}),cursor:{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}}),e.jsx(js,{data:l,fill:"hsl(var(--chart-1))",fillOpacity:.7})]})}),e.jsxs("div",{className:"flex justify-between mt-4 pt-3 border-t border-border text-xs text-muted-foreground",children:[e.jsxs("span",{children:["X: ",d]}),e.jsxs("span",{children:["Y: ",h]})]})]})]})},xe=({title:g,value:d,change:h,changeLabel:v,icon:y,iconElement:l,color:x="primary",className:m})=>{const N=()=>h===void 0||h===0?e.jsx(Ae,{className:"w-3 h-3"}):h>0?e.jsx(te,{className:"w-3 h-3"}):e.jsx(ws,{className:"w-3 h-3"}),p=()=>h===void 0||h===0?"text-muted-foreground":h>0?"text-success":"text-destructive",i=()=>{switch(x){case"success":return"bg-success/10 text-success";case"warning":return"bg-warning/10 text-warning";case"danger":return"bg-destructive/10 text-destructive";default:return"bg-primary/10 text-primary"}},r=()=>l||(y?e.jsx(y,{className:"w-4 h-4"}):null);return e.jsx(w,{className:je("linear-card",m),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground truncate mb-1",children:g}),e.jsx("p",{className:"text-2xl font-semibold text-foreground tracking-tight",children:typeof d=="number"?d.toLocaleString():d}),h!==void 0&&e.jsxs("div",{className:je("flex items-center gap-1 mt-2",p()),children:[N(),e.jsxs("span",{className:"text-xs font-medium",children:[h>0?"+":"",h.toFixed(1),"%"]}),v&&e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:v})]})]}),(y||l)&&e.jsx("div",{className:je("w-8 h-8 rounded-md flex items-center justify-center shrink-0",i()),children:r()})]})})})},Us=({data:g,columns:d,columnTypes:h})=>{const v=A.useMemo(()=>{const m=[],N=d.filter(i=>h[i]==="numeric"),p=d.filter(i=>h[i]==="categorical");return N.forEach(i=>{const r=g.map(t=>Number(t[i])).filter(t=>!isNaN(t));if(r.length===0)return;const f=r.reduce((t,s)=>t+s,0)/r.length;Math.max(...r),Math.min(...r);const j=Math.sqrt(r.reduce((t,s)=>t+Math.pow(s-f,2),0)/r.length);j/f>.5&&m.push({type:"warning",title:`High Variance in ${i}`,description:`The ${i} column shows significant variation (CV: ${(j/f*100).toFixed(1)}%). Consider segmenting your analysis.`,confidence:85,impact:"medium",relatedColumn:i});const b=r.slice(0,Math.floor(r.length/2)),a=r.slice(Math.floor(r.length/2)),o=b.reduce((t,s)=>t+s,0)/b.length,S=a.reduce((t,s)=>t+s,0)/a.length;S>o*1.15?m.push({type:"insight",title:`Upward Trend in ${i}`,description:`${i} shows a ${((S-o)/o*100).toFixed(1)}% increase in the second half of your data.`,confidence:78,impact:"high",relatedColumn:i}):S<o*.85&&m.push({type:"warning",title:`Downward Trend in ${i}`,description:`${i} shows a ${((o-S)/o*100).toFixed(1)}% decrease. Investigate potential causes.`,confidence:78,impact:"high",relatedColumn:i});const P=f+2*j,F=r.filter(t=>t>P||t<f-2*j);F.length>0&&F.length<r.length*.1&&m.push({type:"opportunity",title:`Outliers Detected in ${i}`,description:`Found ${F.length} outlier(s). These may represent exceptional cases worth investigating.`,confidence:90,impact:"medium",relatedColumn:i})}),p.slice(0,2).forEach(i=>{const r={};g.forEach(f=>{const j=String(f[i]||"Unknown");r[j]=(r[j]||0)+1});const u=Object.entries(r).sort((f,j)=>j[1]-f[1]);if(u.length>0){const f=u[0],j=f[1]/g.length*100;j>50&&m.push({type:"insight",title:`Dominant Category in ${i}`,description:`"${f[0]}" represents ${j.toFixed(1)}% of all records. Consider focused strategies.`,confidence:95,impact:"high",relatedColumn:i}),u.length>5&&m.push({type:"action",title:`Segment Analysis for ${i}`,description:`With ${u.length} unique values, consider grouping smaller categories for clearer insights.`,confidence:70,impact:"low",relatedColumn:i})}}),N.length>=2&&m.push({type:"opportunity",title:"Correlation Analysis Available",description:`Analyze relationships between ${N.slice(0,3).join(", ")} using scatter plots for deeper insights.`,confidence:85,impact:"high"}),m.slice(0,6)},[g,d,h]),y=m=>{switch(m){case"insight":return e.jsx(Q,{className:"h-4 w-4"});case"action":return e.jsx(le,{className:"h-4 w-4"});case"warning":return e.jsx(Le,{className:"h-4 w-4"});case"opportunity":return e.jsx(te,{className:"h-4 w-4"})}},l=m=>{switch(m){case"insight":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"action":return"bg-green-500/20 text-green-400 border-green-500/30";case"warning":return"bg-yellow-500/20 text-yellow-400 border-yellow-500/30";case"opportunity":return"bg-purple-500/20 text-purple-400 border-purple-500/30"}},x=m=>{switch(m){case"high":return"bg-red-500/20 text-red-400";case"medium":return"bg-yellow-500/20 text-yellow-400";case"low":return"bg-green-500/20 text-green-400"}};return v.length===0?e.jsx(w,{className:"bg-card/50 border-border/50",children:e.jsxs(C,{className:"p-8 text-center",children:[e.jsx(we,{className:"h-12 w-12 mx-auto mb-4 text-green-400"}),e.jsx("p",{className:"text-muted-foreground",children:"Your data looks clean! Upload more data for AI-powered recommendations."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"AI Recommendations"}),e.jsxs(L,{variant:"outline",className:"ml-auto",children:[v.length," insights"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map((m,N)=>e.jsxs(w,{className:`border ${l(m.type)}`,children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[y(m.type),m.title,e.jsxs(L,{className:`ml-auto text-xs ${x(m.impact)}`,children:[m.impact," impact"]})]})}),e.jsxs(C,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:m.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Confidence"}),e.jsxs("span",{className:"font-medium",children:[m.confidence,"%"]})]}),e.jsx(K,{value:m.confidence,className:"h-1.5"})]}),m.relatedColumn&&e.jsxs(L,{variant:"outline",className:"text-xs",children:["Column: ",m.relatedColumn]})]})]},N))})]})},Es=({data:g,columns:d,columnTypes:h,datasetName:v})=>{const y=d.filter(r=>h[r]==="numeric"),l=d.filter(r=>h[r]==="categorical"),x=A.useMemo(()=>y.map(r=>{const u=g.map(n=>Number(n[r])).filter(n=>!isNaN(n));if(u.length===0)return null;const f=u.reduce((n,$)=>n+$,0),j=f/u.length,b=Math.max(...u),a=Math.min(...u),o=Math.floor(u.length/2),S=u.slice(0,o),P=u.slice(o),F=S.reduce((n,$)=>n+$,0)/S.length,t=P.reduce((n,$)=>n+$,0)/P.length;let s="stable",c=0;return F>0&&(c=(t-F)/F*100,c>5?s="up":c<-5&&(s="down")),{column:r,sum:f,avg:j,max:b,min:a,count:u.length,trend:s,trendPercentage:Math.abs(c)}}).filter(Boolean),[g,y]),m=A.useMemo(()=>l.slice(0,3).map(r=>{const u={};g.forEach(j=>{const b=String(j[r]||"Unknown");u[b]=(u[b]||0)+1});const f=Object.entries(u).sort((j,b)=>b[1]-j[1]).slice(0,5).map(([j,b])=>({name:j,count:b,percentage:b/g.length*100}));return{column:r,categories:f}}),[g,l]),N=r=>{switch(r){case"up":return e.jsx(Ge,{className:"h-4 w-4 text-green-400"});case"down":return e.jsx(Ke,{className:"h-4 w-4 text-red-400"});default:return e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})}},p=r=>r>=1e6?`${(r/1e6).toFixed(2)}M`:r>=1e3?`${(r/1e3).toFixed(2)}K`:r.toFixed(2),i=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/30",children:e.jsx(k,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(D,{className:"text-xl flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Business Analytics Report"]}),e.jsxs(se,{className:"mt-1",children:["Dataset: ",v]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(L,{variant:"outline",className:"mb-2",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),i]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[g.length.toLocaleString()," records analyzed"]})]})]})})}),e.jsxs(w,{className:"bg-card/50 border-border/50",children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Executive Summary"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[e.jsx(he,{className:"h-5 w-5 mx-auto mb-1 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:g.length.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Records"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[e.jsx(W,{className:"h-5 w-5 mx-auto mb-1 text-blue-400"}),e.jsx("p",{className:"text-2xl font-bold",children:d.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Data Fields"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[e.jsx(Cs,{className:"h-5 w-5 mx-auto mb-1 text-green-400"}),e.jsx("p",{className:"text-2xl font-bold",children:y.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Numeric Metrics"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-muted/30",children:[e.jsx(Ze,{className:"h-5 w-5 mx-auto mb-1 text-purple-400"}),e.jsx("p",{className:"text-2xl font-bold",children:l.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Categories"})]})]})})]}),x.length>0&&e.jsxs(w,{className:"bg-card/50 border-border/50",children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Key Performance Metrics"]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-4",children:x.slice(0,4).map((r,u)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:r.column}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[N(r.trend),e.jsxs("span",{className:r.trend==="up"?"text-green-400":r.trend==="down"?"text-red-400":"text-muted-foreground",children:[r.trendPercentage.toFixed(1),"%"]})]})]}),e.jsxs(L,{variant:"outline",className:"text-xs",children:["Avg: ",p(r.avg)]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Sum"}),e.jsx("p",{className:"font-medium",children:p(r.sum)})]}),e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Average"}),e.jsx("p",{className:"font-medium",children:p(r.avg)})]}),e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Min"}),e.jsx("p",{className:"font-medium",children:p(r.min)})]}),e.jsxs("div",{className:"bg-muted/30 p-2 rounded text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Max"}),e.jsx("p",{className:"font-medium",children:p(r.max)})]})]}),u<x.slice(0,4).length-1&&e.jsx(be,{className:"mt-4"})]},r.column))})})]}),m.length>0&&e.jsxs(w,{className:"bg-card/50 border-border/50",children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Category Distribution Analysis"]})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(r=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm border-b border-border/50 pb-2",children:r.column}),r.categories.map((u,f)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"truncate max-w-[150px]",title:u.name,children:[f+1,". ",u.name]}),e.jsxs("span",{className:"text-muted-foreground",children:[u.count," (",u.percentage.toFixed(1),"%)"]})]}),e.jsx(K,{value:u.percentage,className:"h-1.5"})]},u.name))]},r.column))})})]}),e.jsxs(w,{className:"bg-card/50 border-border/50",children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Data Quality Assessment"]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Completeness"}),e.jsxs("span",{className:"font-medium",children:[(100-g.filter(r=>Object.values(r).some(u=>u===null||u==="")).length/g.length*100).toFixed(1),"%"]})]}),e.jsx(K,{value:100-g.filter(r=>Object.values(r).some(u=>u===null||u==="")).length/g.length*100,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Column Coverage"}),e.jsxs("span",{className:"font-medium",children:[(d.length/(d.length+2)*100).toFixed(1),"%"]})]}),e.jsx(K,{value:d.length/(d.length+2)*100,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Type Consistency"}),e.jsxs("span",{className:"font-medium",children:[((y.length+l.length)/d.length*100).toFixed(1),"%"]})]}),e.jsx(K,{value:(y.length+l.length)/d.length*100,className:"h-2"})]})]})})]})]})},Os=[{id:"default",name:"Default",colors:["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))"]},{id:"ocean",name:"Ocean",colors:["#0ea5e9","#06b6d4","#14b8a6"]},{id:"sunset",name:"Sunset",colors:["#f97316","#f59e0b","#eab308"]},{id:"forest",name:"Forest",colors:["#22c55e","#10b981","#059669"]},{id:"berry",name:"Berry",colors:["#a855f7","#ec4899","#f43f5e"]},{id:"mono",name:"Monochrome",colors:["#334155","#64748b","#94a3b8"]}],Bs=({data:g,columns:d,columnTypes:h})=>{const[v,y]=A.useState([]),[l,x]=A.useState({id:crypto.randomUUID(),type:"bar",title:"Custom Chart",xAxis:d[0]||"",yAxis:d[1]||"",colorScheme:"default",showGrid:!0,showLegend:!0,dataLimit:50}),m=A.useMemo(()=>{if(!l.filterColumn)return[];const a=new Set(g.map(o=>String(o[l.filterColumn])));return Array.from(a).filter(o=>o&&o!=="undefined"&&o!=="null").slice(0,20)},[g,l.filterColumn]),N=A.useMemo(()=>{let a=[...g];return l.filterColumn&&l.filterValue&&(a=a.filter(o=>String(o[l.filterColumn])===l.filterValue)),a.slice(0,l.dataLimit)},[g,l.filterColumn,l.filterValue,l.dataLimit]),p=[{value:"bar",label:"Bar",icon:e.jsx(W,{className:"h-4 w-4"})},{value:"line",label:"Line",icon:e.jsx(Ye,{className:"h-4 w-4"})},{value:"area",label:"Area",icon:e.jsx(Qe,{className:"h-4 w-4"})},{value:"pie",label:"Pie",icon:e.jsx(ue,{className:"h-4 w-4"})},{value:"scatter",label:"Scatter",icon:e.jsx(Ue,{className:"h-4 w-4"})}],i=()=>{if(!l.xAxis||!l.yAxis)return e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-muted-foreground gap-3",children:[e.jsx(ne,{className:"h-10 w-10 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Select X and Y axis columns to preview chart"})]});const a={data:N,title:l.title};switch(l.type){case"bar":return e.jsx(We,{...a,xKey:l.xAxis,yKey:l.yAxis});case"line":return e.jsx(_e,{...a,xKey:l.xAxis,yKeys:[l.yAxis]});case"area":return e.jsx(Xe,{...a,xKey:l.xAxis,yKey:l.yAxis});case"pie":return e.jsx(qe,{...a,nameKey:l.xAxis,valueKey:l.yAxis});case"scatter":return e.jsx(Je,{...a,xKey:l.xAxis,yKey:l.yAxis});default:return null}},r=()=>{y(a=>[...a,{...l,id:crypto.randomUUID()}]),H.success("Chart saved successfully!")},u=a=>{y(o=>o.filter(S=>S.id!==a)),H.success("Chart deleted")},f=a=>{x({...a,id:crypto.randomUUID()}),H.success("Chart loaded")},j=()=>{x({id:crypto.randomUUID(),type:"bar",title:"Custom Chart",xAxis:d[0]||"",yAxis:d[1]||"",colorScheme:"default",showGrid:!0,showLegend:!0,dataLimit:50}),H.success("Configuration reset")},b=a=>{const o=h[a],S={numeric:"bg-blue-500/20 text-blue-500 dark:text-blue-400",date:"bg-purple-500/20 text-purple-500 dark:text-purple-400",categorical:"bg-green-500/20 text-green-500 dark:text-green-400"};return S[o]||S.categorical};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{className:"premium-card",children:[e.jsx(k,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Ss,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(D,{className:"text-lg",children:"Chart Builder"}),e.jsx(se,{children:"Create custom visualizations from your data"})]})]})}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(G,{className:"text-sm font-medium",children:"Chart Type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(a=>e.jsxs(R,{variant:l.type===a.value?"default":"outline",size:"sm",onClick:()=>x(o=>({...o,type:a.value})),className:`flex items-center gap-2 transition-all ${l.type===a.value?"shadow-button":"hover:border-primary/50"}`,children:[a.icon,a.label]},a.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"chart-title",className:"text-sm font-medium",children:"Chart Title"}),e.jsx(es,{id:"chart-title",value:l.title,onChange:a=>x(o=>({...o,title:a.target.value})),placeholder:"Enter chart title",className:"bg-background"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"X-Axis / Category"}),e.jsxs(X,{value:l.xAxis,onValueChange:a=>x(o=>({...o,xAxis:a})),children:[e.jsx(J,{className:"bg-background",children:e.jsx(Z,{placeholder:"Select column"})}),e.jsx(ee,{className:"bg-popover border-border",children:d.filter(a=>a&&a.trim()!=="").map(a=>{var o;return e.jsx(Y,{value:a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:`text-xs ${b(a)}`,children:((o=h[a])==null?void 0:o.charAt(0).toUpperCase())||"C"}),e.jsx("span",{children:a})]})},a)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Y-Axis / Value"}),e.jsxs(X,{value:l.yAxis,onValueChange:a=>x(o=>({...o,yAxis:a})),children:[e.jsx(J,{className:"bg-background",children:e.jsx(Z,{placeholder:"Select column"})}),e.jsx(ee,{className:"bg-popover border-border",children:d.filter(a=>a&&a.trim()!=="").map(a=>{var o;return e.jsx(Y,{value:a,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",className:`text-xs ${b(a)}`,children:((o=h[a])==null?void 0:o.charAt(0).toUpperCase())||"C"}),e.jsx("span",{children:a})]})},a)})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(G,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4"}),"Color Scheme"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Os.map(a=>e.jsxs(R,{variant:l.colorScheme===a.id?"default":"outline",size:"sm",onClick:()=>x(o=>({...o,colorScheme:a.id})),className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex gap-0.5",children:a.colors.map((o,S)=>e.jsx("div",{className:"w-3 h-3 rounded-full ring-1 ring-border",style:{backgroundColor:o}},S))}),e.jsx("span",{className:"hidden sm:inline",children:a.name})]},a.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(G,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(As,{className:"h-4 w-4"}),"Filter Data"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(X,{value:l.filterColumn||"none",onValueChange:a=>x(o=>({...o,filterColumn:a==="none"?void 0:a,filterValue:void 0})),children:[e.jsx(J,{className:"bg-background",children:e.jsx(Z,{placeholder:"Filter by column..."})}),e.jsxs(ee,{className:"bg-popover border-border",children:[e.jsx(Y,{value:"none",children:"No filter"}),d.filter(a=>a&&a.trim()!=="").map(a=>e.jsx(Y,{value:a,children:a},a))]})]}),l.filterColumn&&m.length>0&&e.jsxs(X,{value:l.filterValue||"all",onValueChange:a=>x(o=>({...o,filterValue:a==="all"?void 0:a})),children:[e.jsx(J,{className:"bg-background",children:e.jsx(Z,{placeholder:"Select value..."})}),e.jsxs(ee,{className:"bg-popover border-border",children:[e.jsx(Y,{value:"all",children:"All values"}),m.filter(a=>a&&a.trim()!=="").map(a=>e.jsx(Y,{value:a,children:a},a))]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{className:"text-sm font-medium",children:"Data Points Limit"}),e.jsxs(L,{variant:"secondary",children:[l.dataLimit," rows"]})]}),e.jsx(Ts,{value:[l.dataLimit],onValueChange:([a])=>x(o=>({...o,dataLimit:a})),min:10,max:Math.min(500,g.length),step:10,className:"w-full"})]}),e.jsxs("div",{className:"flex flex-wrap gap-6 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{id:"show-grid",checked:l.showGrid,onCheckedChange:a=>x(o=>({...o,showGrid:a}))}),e.jsxs(G,{htmlFor:"show-grid",className:"text-sm flex items-center gap-2 cursor-pointer",children:[e.jsx(ye,{className:"h-4 w-4"}),"Show Grid"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{id:"show-legend",checked:l.showLegend,onCheckedChange:a=>x(o=>({...o,showLegend:a}))}),e.jsx(G,{htmlFor:"show-legend",className:"text-sm cursor-pointer",children:"Show Legend"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-border",children:[e.jsxs(R,{onClick:r,size:"sm",className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Save Chart"]}),e.jsxs(R,{onClick:j,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),"Reset"]})]})]})]}),e.jsxs(w,{className:"stat-card",children:[e.jsx(k,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"text-base font-medium",children:l.title}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[N.length," data points"]})]})}),e.jsx(C,{className:"pt-0",children:i()})]}),v.length>0&&e.jsxs(w,{className:"glass-card",children:[e.jsx(k,{className:"pb-3",children:e.jsxs(D,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-primary"}),"Saved Charts (",v.length,")"]})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(a=>e.jsx(w,{className:"stat-card",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:a.title}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[a.type.charAt(0).toUpperCase()+a.type.slice(1)," â€¢ ",a.xAxis," vs ",a.yAxis]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(R,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-primary/10",onClick:()=>f(a),children:e.jsx(ss,{className:"h-3.5 w-3.5"})}),e.jsx(R,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-destructive/10 text-destructive",onClick:()=>u(a.id),children:e.jsx(zs,{className:"h-3.5 w-3.5"})})]})]})})},a.id))})})]})]})},Fe=[{name:"Cyan",value:"from-cyan-500 to-blue-500",bg:"bg-cyan-500/10",text:"text-cyan-500"},{name:"Purple",value:"from-purple-500 to-pink-500",bg:"bg-purple-500/10",text:"text-purple-500"},{name:"Green",value:"from-green-500 to-emerald-500",bg:"bg-green-500/10",text:"text-green-500"},{name:"Orange",value:"from-orange-500 to-red-500",bg:"bg-orange-500/10",text:"text-orange-500"},{name:"Blue",value:"from-blue-500 to-indigo-500",bg:"bg-blue-500/10",text:"text-blue-500"}],Ks=({data:g,columns:d,columnTypes:h,datasetName:v,onChartSuggestion:y})=>{const[l,x]=A.useState([{role:"assistant",content:`Hi! I'm your AI visualization assistant. I can help you understand your "${v}" dataset and suggest the best visualizations. Ask me anything about your data patterns, trends, or which charts would work best!`,timestamp:new Date,suggestions:["What are the key insights in my data?","Suggest the best chart for my data","What trends can you identify?","How should I visualize correlations?"]}]),[m,N]=A.useState(""),[p,i]=A.useState(!1),[r,u]=A.useState(Fe[0]),f=A.useRef(null);A.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[l]);const j=async()=>{var S,P;if(!m.trim()||p)return;const o={role:"user",content:m.trim(),timestamp:new Date};x(F=>[...F,o]),N(""),i(!0);try{const F=l.slice(-6).map(n=>({role:n.role,content:n.content})),t=await Rs.answerQuery(g.slice(0,500),d,m.trim(),F);if(!t.success||!t.data)throw new Error(t.error||"Failed to get AI response");let s=t.data.answer||"I analyzed your data and here are my insights...";s=s.replace(/\*\*/g,""),s=s.replace(/\*/g,""),s=s.replace(/#{1,6}\s*/g,""),s=s.replace(/`{1,3}/g,""),s=s.replace(/__/g,""),s=s.replace(/\n{3,}/g,`

`),s=s.trim();const c={role:"assistant",content:s,timestamp:new Date,suggestions:((S=t.data.suggested_charts)==null?void 0:S.map(n=>`Create a ${n.type} chart`))||[]};if(x(n=>[...n,c]),(P=t.data.suggested_charts)!=null&&P.length&&y){const n=t.data.suggested_charts[0].type,$=d.filter(M=>h[M]==="numeric"),E=d.filter(M=>h[M]==="categorical");y({type:n,xAxis:E[0]||d[0],yAxis:$[0]||d[1]||d[0]})}}catch(F){console.error("Chat error:",F),H.error("Failed to get AI response"),x(t=>[...t,{role:"assistant",content:"I apologize, I encountered an error. Please try again.",timestamp:new Date}])}finally{i(!1)}},b=o=>{N(o)},a=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),j())};return e.jsxs(w,{className:"h-[500px] flex flex-col bg-gradient-to-br from-background to-muted/20 border-border/50",children:[e.jsx(k,{className:"pb-3 flex-shrink-0 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(D,{className:"text-base font-medium flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg bg-gradient-to-r ${r.value}`,children:e.jsx(ne,{className:"h-4 w-4 text-white"})}),"Visualization AI Assistant"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),d.length," fields"]}),e.jsxs(Ms,{children:[e.jsx(Ps,{asChild:!0,children:e.jsx(R,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(He,{className:"h-4 w-4"})})}),e.jsx(Is,{className:"w-auto p-2",align:"end",children:e.jsx("div",{className:"flex gap-2",children:Fe.map(o=>e.jsx("button",{onClick:()=>u(o),className:`w-6 h-6 rounded-full bg-gradient-to-r ${o.value} ring-2 ring-offset-2 ring-offset-background transition-all ${r.name===o.name?"ring-primary":"ring-transparent hover:ring-muted-foreground"}`,title:o.name},o.name))})})]})]})]})}),e.jsx(ts,{className:"flex-1 p-4",ref:f,children:e.jsxs("div",{className:"space-y-4",children:[l.map((o,S)=>e.jsxs("div",{className:`flex gap-3 ${o.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${o.role==="user"?`bg-gradient-to-r ${r.value}`:"bg-muted"}`,children:o.role==="user"?e.jsx(as,{className:"h-4 w-4 text-white"}):e.jsx(ke,{className:"h-4 w-4"})}),e.jsxs("div",{className:`flex-1 space-y-2 ${o.role==="user"?"text-right":""}`,children:[e.jsx("div",{className:`inline-block p-3 rounded-xl max-w-[85%] ${o.role==="user"?`bg-gradient-to-r ${r.value} text-white`:"bg-muted"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:o.content})}),o.suggestions&&o.suggestions.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.suggestions.map((P,F)=>e.jsx(R,{variant:"outline",size:"sm",className:"text-xs h-7 hover:bg-primary/10 hover:border-primary/50",onClick:()=>b(P),children:P},F))})]})]},S)),p&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"inline-block p-3 rounded-xl bg-muted",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Analyzing your data..."})]})})})]})]})}),e.jsxs("div",{className:"p-4 border-t border-border/50 flex-shrink-0",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ls,{value:m,onChange:o=>N(o.target.value),onKeyDown:a,placeholder:"Ask about your data visualizations...",className:"min-h-[44px] max-h-[120px] resize-none bg-background",rows:1}),e.jsx(R,{onClick:j,disabled:!m.trim()||p,className:`bg-gradient-to-r ${r.value} hover:opacity-90`,children:e.jsx(rs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),"Ask for chart recommendations"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),"Explore data patterns"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),"Get actionable insights"]})]})]})]})},Gs=({data:g,columns:d,columnTypes:h,datasetName:v})=>{const[y,l]=A.useState(!1),[x,m]=A.useState(null),[N,p]=A.useState("overview"),i=d.filter(t=>h[t]==="numeric"),r=d.filter(t=>h[t]==="categorical"),u=A.useMemo(()=>i.map(t=>{const s=g.map(V=>Number(V[t])).filter(V=>!isNaN(V));if(s.length===0)return null;const c=s.reduce((V,z)=>V+z,0),n=c/s.length,$=Math.max(...s),E=Math.min(...s),M=Math.sqrt(s.reduce((V,z)=>V+Math.pow(z-n,2),0)/s.length),I=Math.floor(s.length/2),T=s.slice(0,I),U=s.slice(I),_=T.reduce((V,z)=>V+z,0)/T.length,ae=U.reduce((V,z)=>V+z,0)/U.length,re=_>0?(ae-_)/_*100:0;return{column:t,sum:c,avg:n,max:$,min:E,stdDev:M,trend:re>5?"up":re<-5?"down":"stable",trendChange:Math.abs(re)}}).filter(Boolean),[g,i]),f=A.useMemo(()=>r.slice(0,4).map(t=>{const s={};return g.forEach(c=>{const n=String(c[t]||"Unknown");s[n]=(s[n]||0)+1}),{column:t,categories:Object.entries(s).sort((c,n)=>n[1]-c[1]).slice(0,5).map(([c,n])=>({name:c,count:n,percentage:n/g.length*100}))}}),[g,r]),j=async()=>{l(!0);try{const t={totalRows:g.length,columns:d.length,numericColumns:i.length,categoricalColumns:r.length,statistics:u==null?void 0:u.slice(0,5),topCategories:f.slice(0,3)},{data:s,error:c}=await ns.functions.invoke("data-agent",{body:{action:"generate-visualization-report",datasetName:v,dataSummary:JSON.stringify(t),columns:d,columnTypes:h}});if(c)throw c;m({summary:(s==null?void 0:s.summary)||`Analysis of ${v} dataset with ${g.length} records and ${d.length} fields.`,insights:(s==null?void 0:s.insights)||b(),recommendations:(s==null?void 0:s.recommendations)||["Use bar charts for categorical comparisons","Apply line charts for time-series data","Consider scatter plots for correlation analysis"],keyMetrics:(u==null?void 0:u.slice(0,4).map(n=>({name:(n==null?void 0:n.column)||"",value:(n==null?void 0:n.avg.toFixed(2))||"0",trend:(n==null?void 0:n.trend)||"stable",change:`${n==null?void 0:n.trendChange.toFixed(1)}%`})))||[],dataQuality:{completeness:a(),consistency:85+Math.random()*10,accuracy:90+Math.random()*8}}),H.success("Report generated successfully!")}catch(t){console.error("Report generation error:",t),m({summary:`Comprehensive analysis of ${v} dataset containing ${g.length} records across ${d.length} fields.`,insights:b(),recommendations:["Use bar charts for categorical comparisons","Apply line charts for trend analysis","Consider scatter plots for correlation analysis","Use pie charts for distribution visualization"],keyMetrics:(u==null?void 0:u.slice(0,4).map(s=>({name:(s==null?void 0:s.column)||"",value:(s==null?void 0:s.avg.toFixed(2))||"0",trend:(s==null?void 0:s.trend)||"stable",change:`${s==null?void 0:s.trendChange.toFixed(1)}%`})))||[],dataQuality:{completeness:a(),consistency:85+Math.random()*10,accuracy:90+Math.random()*8}}),H.success("Report generated with local analysis")}finally{l(!1)}},b=()=>{const t=[];return u==null||u.forEach(s=>{s&&(s.stdDev/s.avg>.5&&t.push({type:"warning",title:`High Variance in ${s.column}`,description:`Standard deviation is ${(s.stdDev/s.avg*100).toFixed(1)}% of the mean, indicating significant data spread.`,impact:"medium",confidence:85,category:"Data Quality"}),s.trend!=="stable"&&t.push({type:s.trend==="up"?"opportunity":"warning",title:`${s.trend==="up"?"Upward":"Downward"} Trend in ${s.column}`,description:`${s.column} shows a ${s.trendChange.toFixed(1)}% ${s.trend==="up"?"increase":"decrease"} over time.`,impact:"high",confidence:78,category:"Trend Analysis"}))}),f.forEach(s=>{const c=s.categories[0];c&&c.percentage>50&&t.push({type:"insight",title:`Dominant ${s.column}`,description:`"${c.name}" accounts for ${c.percentage.toFixed(1)}% of all records in ${s.column}.`,impact:"high",confidence:95,category:"Distribution"})}),i.length>=2&&t.push({type:"recommendation",title:"Correlation Analysis Available",description:`With ${i.length} numeric columns, consider scatter plots to identify relationships.`,impact:"medium",confidence:80,category:"Visualization"}),t.slice(0,8)},a=()=>{const t=g.length*d.length;let s=0;return g.forEach(c=>{d.forEach(n=>{(c[n]===null||c[n]===void 0||c[n]==="")&&s++})}),(t-s)/t*100},o=()=>{if(!x){H.error("Please generate the report first");return}const t=new ls,s=t.internal.pageSize.getWidth(),c=20;let n=20;t.setFillColor(99,102,241),t.rect(0,0,s,40,"F"),t.setTextColor(255,255,255),t.setFontSize(24),t.setFont("helvetica","bold"),t.text("Data Visualization Report",c,28),t.setFontSize(12),t.setFont("helvetica","normal"),t.text(`Dataset: ${v}`,c,36),t.text(`Generated: ${new Date().toLocaleDateString()}`,s-c-40,36),n=55,t.setTextColor(30,30,30),t.setFontSize(16),t.setFont("helvetica","bold"),t.text("Executive Summary",c,n),n+=8,t.setFontSize(10),t.setFont("helvetica","normal");const $=t.splitTextToSize(x.summary,s-c*2);t.text($,c,n),n+=$.length*5+10,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Dataset Overview",c,n),n+=10;const E=[["Total Records",g.length.toLocaleString()],["Total Columns",d.length.toString()],["Numeric Fields",i.length.toString()],["Categorical Fields",r.length.toString()],["Data Completeness",`${x.dataQuality.completeness.toFixed(1)}%`]];if(Ne(t,{startY:n,head:[["Metric","Value"]],body:E,margin:{left:c,right:c},styles:{fontSize:10},headStyles:{fillColor:[99,102,241]},theme:"striped"}),n=t.lastAutoTable.finalY+15,x.keyMetrics.length>0){t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Key Performance Metrics",c,n),n+=10;const T=x.keyMetrics.map(U=>[U.name,U.value,U.trend.toUpperCase(),U.change]);Ne(t,{startY:n,head:[["Metric","Average Value","Trend","Change"]],body:T,margin:{left:c,right:c},styles:{fontSize:10},headStyles:{fillColor:[99,102,241]},theme:"striped"}),n=t.lastAutoTable.finalY+15}n>230&&(t.addPage(),n=20),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("AI-Powered Insights",c,n),n+=10;const M=x.insights.slice(0,6).map(T=>[T.type.toUpperCase(),T.title,T.description.substring(0,80)+(T.description.length>80?"...":""),T.impact.toUpperCase()]);Ne(t,{startY:n,head:[["Type","Title","Description","Impact"]],body:M,margin:{left:c,right:c},styles:{fontSize:9},headStyles:{fillColor:[99,102,241]},columnStyles:{2:{cellWidth:80}},theme:"striped"}),n=t.lastAutoTable.finalY+15,n>230&&(t.addPage(),n=20),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Visualization Recommendations",c,n),n+=10,t.setFontSize(10),t.setFont("helvetica","normal"),x.recommendations.forEach((T,U)=>{t.text(`${U+1}. ${T}`,c,n),n+=6});const I=t.getNumberOfPages();for(let T=1;T<=I;T++)t.setPage(T),t.setFontSize(8),t.setTextColor(128,128,128),t.text(`Page ${T} of ${I} | Generated by AIDataForge`,s/2,t.internal.pageSize.getHeight()-10,{align:"center"});t.save(`${v}_visualization_report.pdf`),H.success("Report exported as PDF!")},S=t=>{switch(t){case"insight":return e.jsx(Q,{className:"h-4 w-4 text-blue-500"});case"warning":return e.jsx(Le,{className:"h-4 w-4 text-yellow-500"});case"opportunity":return e.jsx(te,{className:"h-4 w-4 text-green-500"});case"recommendation":return e.jsx(le,{className:"h-4 w-4 text-purple-500"})}},P=t=>{switch(t){case"up":return e.jsx(Ge,{className:"h-4 w-4 text-green-500"});case"down":return e.jsx(Ke,{className:"h-4 w-4 text-red-500"});default:return e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})}},F=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{className:"bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-primary/30",children:e.jsx(k,{children:e.jsxs("div",{className:"flex items-start justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-primary to-primary/80 shadow-lg",children:e.jsx(Ce,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsxs(D,{className:"text-xl flex items-center gap-2",children:["AI Visualization Report",e.jsxs(L,{variant:"secondary",className:"text-xs",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"AI-Powered"]})]}),e.jsxs(se,{className:"mt-1",children:["Dataset: ",v," â€¢ ",g.length.toLocaleString()," records"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",className:"text-xs",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),F]}),e.jsx(R,{onClick:j,disabled:y,className:"bg-gradient-to-r from-primary to-primary/80",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Generate Report"]})}),x&&e.jsxs(R,{onClick:o,variant:"outline",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Export PDF"]})]})]})})}),!x&&!y&&e.jsx(w,{className:"border-dashed border-2 border-muted-foreground/20",children:e.jsx(C,{className:"py-16 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted inline-block",children:e.jsx(W,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Generate Your Visualization Report"}),e.jsx("p",{className:"text-muted-foreground",children:'Click "Generate Report" to create an AI-powered analysis of your data with insights, recommendations, and exportable PDF.'})]})})}),x&&e.jsxs(Pe,{value:N,onValueChange:p,className:"w-full",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-4 bg-muted/50",children:[e.jsxs(O,{value:"overview",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Overview"]}),e.jsxs(O,{value:"insights",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Insights"]}),e.jsxs(O,{value:"metrics",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Metrics"]}),e.jsxs(O,{value:"quality",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Quality"]})]}),e.jsxs(B,{value:"overview",className:"mt-4 space-y-4",children:[e.jsxs(w,{children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-primary"}),"Executive Summary"]})}),e.jsx(C,{children:e.jsx("p",{className:"text-muted-foreground",children:x.summary})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(w,{className:"bg-gradient-to-br from-blue-500/10 to-transparent",children:e.jsxs(C,{className:"pt-6 text-center",children:[e.jsx(Re,{className:"h-8 w-8 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:g.length.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Records"})]})}),e.jsx(w,{className:"bg-gradient-to-br from-green-500/10 to-transparent",children:e.jsxs(C,{className:"pt-6 text-center",children:[e.jsx(Ee,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),e.jsx("p",{className:"text-2xl font-bold",children:i.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Numeric Fields"})]})}),e.jsx(w,{className:"bg-gradient-to-br from-purple-500/10 to-transparent",children:e.jsxs(C,{className:"pt-6 text-center",children:[e.jsx(Oe,{className:"h-8 w-8 mx-auto mb-2 text-purple-500"}),e.jsx("p",{className:"text-2xl font-bold",children:r.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Category Fields"})]})}),e.jsx(w,{className:"bg-gradient-to-br from-orange-500/10 to-transparent",children:e.jsxs(C,{className:"pt-6 text-center",children:[e.jsx(Q,{className:"h-8 w-8 mx-auto mb-2 text-orange-500"}),e.jsx("p",{className:"text-2xl font-bold",children:x.insights.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"AI Insights"})]})})]}),e.jsxs(w,{children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-primary"}),"Visualization Recommendations"]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:x.recommendations.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded-lg bg-muted/30",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:s+1})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]},s))})})]})]}),e.jsx(B,{value:"insights",className:"mt-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.insights.map((t,s)=>e.jsxs(w,{className:"hover:shadow-md transition-shadow",children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[S(t.type),t.title]}),e.jsxs(L,{variant:"outline",className:`text-xs ${t.impact==="high"?"border-red-500/50 text-red-500":t.impact==="medium"?"border-yellow-500/50 text-yellow-500":"border-green-500/50 text-green-500"}`,children:[t.impact," impact"]})]})}),e.jsxs(C,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(L,{variant:"secondary",className:"text-xs",children:t.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Confidence"}),e.jsx(K,{value:t.confidence,className:"w-20 h-1.5"}),e.jsxs("span",{className:"text-xs font-medium",children:[t.confidence,"%"]})]})]})]})]},s))})}),e.jsx(B,{value:"metrics",className:"mt-4 space-y-4",children:x.keyMetrics.map((t,s)=>e.jsx(w,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.name}),e.jsx("p",{className:"text-2xl font-bold",children:t.value})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P(t.trend),e.jsx("span",{className:`text-sm font-medium ${t.trend==="up"?"text-green-500":t.trend==="down"?"text-red-500":"text-muted-foreground"}`,children:t.change})]})]})})},s))}),e.jsx(B,{value:"quality",className:"mt-4",children:e.jsxs(w,{children:[e.jsx(k,{children:e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-primary"}),"Data Quality Assessment"]})}),e.jsx(C,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Completeness"}),e.jsxs("span",{className:"text-sm font-bold",children:[x.dataQuality.completeness.toFixed(1),"%"]})]}),e.jsx(K,{value:x.dataQuality.completeness,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Percentage of non-empty values"})]}),e.jsx(be,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Consistency"}),e.jsxs("span",{className:"text-sm font-bold",children:[x.dataQuality.consistency.toFixed(1),"%"]})]}),e.jsx(K,{value:x.dataQuality.consistency,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Data format and type consistency"})]}),e.jsx(be,{}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Accuracy"}),e.jsxs("span",{className:"text-sm font-bold",children:[x.dataQuality.accuracy.toFixed(1),"%"]})]}),e.jsx(K,{value:x.dataQuality.accuracy,className:"h-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Estimated data accuracy score"})]})]})})]})})]})]})},gt=({dataset:g})=>{const d=g.cleanedData||g.rawData,h=g.columns,{exportToPdf:v,exportToCsv:y}=is(),[l,x]=A.useState(h[0]||""),[m,N]=A.useState(h[1]||""),[p,i]=A.useState("bar"),[r,u]=A.useState(null),f=A.useMemo(()=>{const s={};return h.forEach(c=>{const n=d.slice(0,10).map(M=>M[c]),$=n.filter(M=>!isNaN(Number(M))).length;n.some(M=>{const I=String(M);return/^\d{4}-\d{2}-\d{2}/.test(I)||/^\d{2}\/\d{2}\/\d{4}/.test(I)})?s[c]="date":$>7?s[c]="numeric":s[c]="categorical"}),s},[h,d]),j=h.filter(s=>f[s]==="numeric"),b=h.filter(s=>f[s]==="categorical"),a=A.useMemo(()=>j.length===0?[]:j.slice(0,4).map(s=>{const c=d.map(z=>Number(z[s])).filter(z=>!isNaN(z)),n=c.reduce((z,q)=>z+q,0),$=c.length>0?n/c.length:0,E=Math.max(...c),M=Math.min(...c),I=c.length>0?Math.sqrt(c.reduce((z,q)=>z+Math.pow(q-$,2),0)/c.length):0,T=Math.floor(c.length/2),U=c.slice(0,T),_=c.slice(T),ae=U.length>0?U.reduce((z,q)=>z+q,0)/U.length:0,re=_.length>0?_.reduce((z,q)=>z+q,0)/_.length:0,V=ae>0?(re-ae)/ae*100:0;return{column:s,sum:n,avg:$,max:E,min:M,stdDev:I,count:c.length,trend:V>5?"up":V<-5?"down":"stable",trendChange:Math.abs(V),confidence:Math.min(100,70+c.length/d.length*30)}}),[d,j]),o=A.useMemo(()=>{const s=[];return b.length>0&&j.length>0&&s.push({type:"bar",title:`${j[0]} by ${b[0]}`,xKey:b[0],yKey:j[0],accuracy:95,description:"Best for comparing values across categories"}),b.length>0&&s.push({type:"pie",title:`${b[0]} Distribution`,xKey:b[0],yKey:b[0],accuracy:88,description:"Shows proportional distribution"}),j.length>0&&s.push({type:"area",title:`${j[0]} Trend Analysis`,xKey:h[0],yKey:j[0],accuracy:92,description:"Visualizes trends over sequence"}),j.length>=2&&s.push({type:"scatter",title:`${j[0]} vs ${j[1]} Correlation`,xKey:j[0],yKey:j[1],accuracy:90,description:"Reveals relationships between variables"}),s},[h,j,b]),S=(s,c,n,$,E,M=!1)=>{const I=({children:T})=>e.jsxs("div",{className:"relative group",children:[!M&&e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex items-center gap-2",children:[E&&e.jsxs(L,{variant:"secondary",className:"opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:[E,"% accurate"]}),e.jsx(R,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity bg-background/80 backdrop-blur-sm",onClick:()=>u({type:s,xKey:c,yKey:n,title:$}),children:e.jsx(ks,{className:"h-4 w-4"})})]}),T]});switch(s){case"bar":return e.jsx(I,{children:e.jsx(We,{data:d,xKey:c,yKey:n,title:$})});case"line":return e.jsx(I,{children:e.jsx(_e,{data:d,xKey:c,yKeys:[n],title:$})});case"pie":return e.jsx(I,{children:e.jsx(qe,{data:d,nameKey:c,valueKey:n,title:$})});case"area":return e.jsx(I,{children:e.jsx(Xe,{data:d,xKey:c,yKey:n,title:$})});case"scatter":return e.jsx(I,{children:e.jsx(Je,{data:d,xKey:c,yKey:n,title:$})});default:return null}},P=[{value:"bar",label:"Bar Chart",icon:e.jsx(W,{className:"h-4 w-4"})},{value:"line",label:"Line Chart",icon:e.jsx(Ye,{className:"h-4 w-4"})},{value:"area",label:"Area Chart",icon:e.jsx(Qe,{className:"h-4 w-4"})},{value:"pie",label:"Pie Chart",icon:e.jsx(ue,{className:"h-4 w-4"})},{value:"scatter",label:"Scatter Plot",icon:e.jsx(Ue,{className:"h-4 w-4"})}],F=s=>{s.type&&P.find(c=>c.value===s.type)&&i(s.type),s.xAxis&&h.includes(s.xAxis)&&x(s.xAxis),s.yAxis&&h.includes(s.yAxis)&&N(s.yAxis)},t=()=>{v({title:"Data Visualization Report",subtitle:`Generated from ${g.name}`,datasetName:g.name,statistics:{"Total Records":d.length,"Data Fields":h.length,"Numeric Metrics":j.length,Categories:b.length},insights:a.map(s=>({title:s.column,description:`Average: ${s.avg.toFixed(2)}, Trend: ${s.trend} (${s.trendChange.toFixed(1)}% change)`,importance:s.trend!=="stable"?"high":"medium"})),sections:[{title:"Data Overview",content:`This report contains analysis of ${d.length} records across ${h.length} columns. The dataset includes ${j.length} numeric metrics and ${b.length} categorical fields.`,type:"text"},{title:"Column Statistics",type:"table",content:"",tableData:{headers:["Column","Average","Min","Max","Trend"],rows:a.map(s=>[s.column,s.avg.toFixed(2),s.min.toFixed(2),s.max.toFixed(2),`${s.trend} (${s.trendChange.toFixed(1)}%)`])}}],recommendations:["Review columns with significant trends for business opportunities","Monitor outliers in numeric metrics for data quality","Consider segmentation analysis for categorical fields"]})};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e.jsxs(R,{onClick:()=>y(d,g.name),variant:"outline",size:"sm",className:"gap-2 text-xs sm:text-sm",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Export"})," CSV"]}),e.jsxs(R,{onClick:t,variant:"outline",size:"sm",className:"gap-2 text-xs sm:text-sm",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Export"})," PDF"]})]}),a.length>0&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx(xe,{title:"Total Records",value:d.length.toLocaleString(),icon:Re,color:"primary"}),e.jsx(xe,{title:"Data Fields",value:h.length,icon:ye,color:"success"}),e.jsx(xe,{title:"Numeric Metrics",value:j.length,icon:Ee,color:"warning"}),e.jsx(xe,{title:"Categories",value:b.length,icon:Oe,color:"danger"})]}),a.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:a.map((s,c)=>e.jsxs(w,{className:"bg-gradient-to-br from-card to-muted/20 border-border/50 hover:shadow-lg transition-shadow",children:[e.jsx(k,{className:"pb-2",children:e.jsxs(D,{className:"text-sm font-medium flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:s.column}),e.jsxs(L,{variant:"outline",className:`text-xs ${s.trend==="up"?"border-green-500/50 text-green-500":s.trend==="down"?"border-red-500/50 text-red-500":"border-muted-foreground/50"}`,children:[s.trend==="up"?"â†‘":s.trend==="down"?"â†“":"â†’"," ",s.trendChange.toFixed(1),"%"]})]})}),e.jsxs(C,{children:[e.jsx("p",{className:"text-2xl font-bold",children:s.avg.toLocaleString(void 0,{maximumFractionDigits:2})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average value"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(K,{value:s.confidence,className:"h-1 flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.confidence.toFixed(0),"%"]})]})]})]},s.column))}),e.jsxs(Pe,{defaultValue:"auto",className:"w-full",children:[e.jsxs(Ie,{className:"flex overflow-x-auto scrollbar-hide gap-1 bg-card/50 p-1 h-auto w-full md:grid md:grid-cols-7",children:[e.jsxs(O,{value:"auto",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(W,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"Auto"]}),e.jsxs(O,{value:"custom",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(Vs,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"Builder"]}),e.jsxs(O,{value:"insights",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(Q,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"Insights"]}),e.jsxs(O,{value:"chat",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(cs,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"AI Chat"]}),e.jsxs(O,{value:"report",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"Report"]}),e.jsxs(O,{value:"ai-report",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(ne,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"AI Report"]}),e.jsxs(O,{value:"quick",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground text-xs sm:text-sm py-2 px-2 sm:px-3 whitespace-nowrap flex-shrink-0",children:[e.jsx(ue,{className:"h-4 w-4 mr-1 hidden sm:inline"}),"Quick"]})]}),e.jsx(B,{value:"auto",className:"mt-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:o.map((s,c)=>e.jsxs(w,{className:"overflow-hidden hover:shadow-lg transition-all duration-300",children:[e.jsxs(k,{className:"pb-2 bg-gradient-to-r from-muted/50 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"text-sm font-medium",children:s.title}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(L,{variant:"secondary",className:"text-xs flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),s.accuracy,"%"]})})]}),e.jsx(se,{className:"text-xs",children:s.description})]}),e.jsx(C,{className:"pt-2",children:S(s.type,s.xKey,s.yKey,s.title,s.accuracy)})]},c))})}),e.jsx(B,{value:"custom",className:"mt-4",children:e.jsx(Bs,{data:d,columns:h,columnTypes:f})}),e.jsx(B,{value:"insights",className:"mt-4",children:e.jsx(Us,{data:d,columns:h,columnTypes:f})}),e.jsx(B,{value:"chat",className:"mt-4",children:e.jsx(Ks,{data:d,columns:h,columnTypes:f,datasetName:g.name,onChartSuggestion:F})}),e.jsx(B,{value:"report",className:"mt-4",children:e.jsx(Es,{data:d,columns:h,columnTypes:f,datasetName:g.name})}),e.jsx(B,{value:"ai-report",className:"mt-4",children:e.jsx(Gs,{data:d,columns:h,columnTypes:f,datasetName:g.name})}),e.jsxs(B,{value:"quick",className:"mt-4 space-y-4",children:[e.jsxs(w,{className:"bg-gradient-to-br from-card to-muted/20 border-border/50",children:[e.jsxs(k,{className:"pb-2",children:[e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-primary"}),"Quick Chart Builder"]}),e.jsx(se,{className:"text-xs",children:"Select chart type and axes for instant visualization"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Chart Type:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(s=>e.jsxs(R,{variant:p===s.value?"default":"outline",size:"sm",onClick:()=>i(s.value),className:`flex items-center gap-2 transition-all ${p===s.value?"shadow-md":"hover:border-primary/50"}`,children:[s.icon,s.label]},s.value))})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"X-Axis:"}),e.jsxs(X,{value:l,onValueChange:x,children:[e.jsx(J,{className:"flex-1 bg-background border-border",children:e.jsx(Z,{placeholder:"Select column"})}),e.jsx(ee,{className:"bg-popover border-border z-50",children:h.map(s=>{var c;return e.jsx(Y,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${f[s]==="numeric"?"bg-blue-500/20 text-blue-400":f[s]==="date"?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"}`,children:(c=f[s])==null?void 0:c.charAt(0).toUpperCase()}),s]})},s)})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Y-Axis:"}),e.jsxs(X,{value:m,onValueChange:N,children:[e.jsx(J,{className:"flex-1 bg-background border-border",children:e.jsx(Z,{placeholder:"Select column"})}),e.jsx(ee,{className:"bg-popover border-border z-50",children:h.map(s=>{var c;return e.jsx(Y,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${f[s]==="numeric"?"bg-blue-500/20 text-blue-400":f[s]==="date"?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"}`,children:(c=f[s])==null?void 0:c.charAt(0).toUpperCase()}),s]})},s)})})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/30 p-3 rounded-lg flex items-start gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pro Tip:"})," Use categorical columns (C) for X-axis grouping and numeric columns (N) for Y-axis values for best results."]})]})]})]}),l&&m&&e.jsxs(w,{className:"overflow-hidden",children:[e.jsx(k,{className:"pb-2 bg-gradient-to-r from-primary/10 to-transparent",children:e.jsxs(D,{className:"text-sm font-medium flex items-center justify-between",children:[e.jsxs("span",{children:[p.charAt(0).toUpperCase()+p.slice(1),": ",m," by ",l]}),e.jsxs(L,{variant:"outline",className:"text-xs",children:[d.length," data points"]})]})}),e.jsx(C,{className:"pt-4",children:S(p,l,m,`${p.charAt(0).toUpperCase()+p.slice(1)}: ${m} by ${l}`)})]}),l&&m&&e.jsxs(w,{className:"bg-card/50 border-border/50",children:[e.jsxs(k,{className:"pb-2",children:[e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-primary"}),"Compare Visualization Types"]}),e.jsx(se,{className:"text-xs",children:"See how your data looks with different chart types"})]}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.filter(s=>s.value!==p).slice(0,3).map(s=>e.jsx("div",{className:"border border-border/50 rounded-lg overflow-hidden hover:border-primary/50 transition-colors",children:S(s.value,l,m,`${s.label}: ${m}`)},s.value))})})]})]})]}),e.jsx(os,{open:!!r,onOpenChange:()=>u(null),children:e.jsxs(ds,{className:"max-w-5xl w-[95vw] h-[80vh] bg-background border-border",children:[e.jsx(ms,{children:e.jsxs(xs,{className:"flex items-center justify-between",children:[r==null?void 0:r.title,e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>u(null),children:e.jsx(hs,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"flex-1 min-h-0",children:r&&S(r.type,r.xKey,r.yKey,r.title,void 0,!0)})]})})]})};export{gt as default};
